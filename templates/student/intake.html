<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wellbeing Assessment | AI-Powered Mental Health Support</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d1b69 100%);
            color: #e0e7ff;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-input, .form-select, .form-textarea {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e0e7ff;
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s ease;
            font-size: 1rem;
            width: 100%;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.25);
            background: rgba(255, 255, 255, 0.12);
            outline: none;
        }
        
        .severity-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #a78bfa;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .severity-btn:hover {
            transform: scale(1.1);
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.2);
        }
        
        .severity-btn.active {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border-color: #8b5cf6;
            color: white;
            transform: scale(1.15);
        }
        
        .radio-option, .checkbox-option {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .radio-option:hover, .checkbox-option:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #8b5cf6;
        }
        
        .radio-option.selected, .checkbox-option.selected {
            background: rgba(139, 92, 246, 0.2);
            border-color: #8b5cf6;
        }
        
        .crisis-warning {
            background: linear-gradient(135deg, #7f1d1d, #991b1b);
            border: 1px solid #ef4444;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            animation: pulseWarning 2s infinite;
        }
        
        @keyframes pulseWarning {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .form-section {
            margin-bottom: 2rem;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .section-number {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 1rem;
            color: white;
        }
        
        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            border-radius: 2px;
            transition: width 0.5s ease;
        }
        
        .highlight-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-left: 4px solid #3b82f6;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .flash-message {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-left: 4px solid #3b82f6;
            color: #93c5fd;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        
        .flash-success {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
            border-left-color: #10b981;
            color: #6ee7b7;
        }
        
        .flash-error {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            border-left-color: #ef4444;
            color: #fca5a5;
        }
    </style>
</head>
<body class="min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">
                <i class="fas fa-brain mr-3"></i>Wellbeing Assessment
            </h1>
            <p class="text-lg text-purple-300 mb-4">
                Help us understand your needs so we can provide personalized support
            </p>
            <div class="progress-bar max-w-md mx-auto">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <p class="text-sm text-purple-400 mt-2">
                Complete assessment to get matched with a therapist
            </p>
        </div>

        <!-- Assessment Form -->
        <form id="intake-form" action="{{ url_for('dashboard.student_intake') }}" method="POST">
            
            <!-- Primary Concern -->
            <div class="glass-card">
                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">1</span>
                        <h2 class="text-xl font-bold text-white">What's your primary concern today?</h2>
                    </div>
                    <select name="primary_concern" class="form-select" required>
                        <option value="">Select your main concern...</option>
                        <option value="anxiety">üò∞ Anxiety & Worry</option>
                        <option value="depression">üòî Depression & Low Mood</option>
                        <option value="academic_stress">üìö Academic Stress & Pressure</option>
                        <option value="relationships">üíî Relationship Issues</option>
                        <option value="sleep">üò¥ Sleep Problems</option>
                        <option value="eating">üçΩÔ∏è Eating Concerns</option>
                        <option value="substance">üç∑ Substance Use</option>
                        <option value="trauma">üí• Trauma/PTSD</option>
                        <option value="grief">üò¢ Grief & Loss</option>
                        <option value="identity">ü™û Identity & Self-esteem</option>
                        <option value="other">ü§î Other</option>
                    </select>
                </div>
            </div>

            <!-- Description -->
            <div class="glass-card">
                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">2</span>
                        <h2 class="text-xl font-bold text-white">Tell us more about what you're experiencing</h2>
                    </div>
                    <textarea name="description" rows="4" class="form-textarea" 
                              placeholder="Describe your feelings, symptoms, or situations that brought you here..."
                              required></textarea>
                </div>
            </div>

            <!-- Severity Rating -->
            <div class="glass-card">
                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">3</span>
                        <h2 class="text-xl font-bold text-white">How would you rate the severity of your concerns?</h2>
                    </div>
                    
                    <div class="flex justify-center space-x-3 mb-4" id="severity-scale">
                        <button type="button" class="severity-btn" data-value="1" onclick="setSeverity(1)">1</button>
                        <button type="button" class="severity-btn" data-value="2" onclick="setSeverity(2)">2</button>
                        <button type="button" class="severity-btn" data-value="3" onclick="setSeverity(3)">3</button>
                        <button type="button" class="severity-btn" data-value="4" onclick="setSeverity(4)">4</button>
                        <button type="button" class="severity-btn" data-value="5" onclick="setSeverity(5)">5</button>
                        <button type="button" class="severity-btn" data-value="6" onclick="setSeverity(6)">6</button>
                        <button type="button" class="severity-btn" data-value="7" onclick="setSeverity(7)">7</button>
                        <button type="button" class="severity-btn" data-value="8" onclick="setSeverity(8)">8</button>
                        <button type="button" class="severity-btn" data-value="9" onclick="setSeverity(9)">9</button>
                        <button type="button" class="severity-btn" data-value="10" onclick="setSeverity(10)">10</button>
                    </div>
                    <input type="hidden" name="severity" id="severity-input" required>
                    
                    <div class="flex justify-between text-sm text-purple-300">
                        <span>1 = Mild discomfort</span>
                        <span>10 = Severe, urgent need for help</span>
                    </div>
                </div>
            </div>

            <!-- Duration -->
            <div class="glass-card">
                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">4</span>
                        <h2 class="text-xl font-bold text-white">How long have you been experiencing these concerns?</h2>
                    </div>
                    <select name="duration" class="form-select" required>
                        <option value="">Select duration...</option>
                        <option value="less_than_week">üìÖ Less than a week</option>
                        <option value="1-2_weeks">üìÖ 1-2 weeks</option>
                        <option value="1_month">üìÖ About a month</option>
                        <option value="2-3_months">üìÖ 2-3 months</option>
                        <option value="6_months">üìÖ About 6 months</option>
                        <option value="1_year">üìÖ About a year</option>
                        <option value="more_than_year">üìÖ More than a year</option>
                    </select>
                </div>
            </div>

            <!-- Previous Therapy -->
            <div class="glass-card">
                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">5</span>
                        <h2 class="text-xl font-bold text-white">Have you received mental health treatment before?</h2>
                    </div>
                    <div class="space-y-3">
                        <label class="radio-option cursor-pointer">
                            <input type="radio" name="previous_therapy" value="never" class="mr-3" onchange="selectRadio(this)">
                            <span>üÜï Never received treatment</span>
                        </label>
                        <label class="radio-option cursor-pointer">
                            <input type="radio" name="previous_therapy" value="counseling" class="mr-3" onchange="selectRadio(this)">
                            <span>üí¨ Counseling/Therapy only</span>
                        </label>
                        <label class="radio-option cursor-pointer">
                            <input type="radio" name="previous_therapy" value="medication" class="mr-3" onchange="selectRadio(this)">
                            <span>üíä Medication only</span>
                        </label>
                        <label class="radio-option cursor-pointer">
                            <input type="radio" name="previous_therapy" value="both" class="mr-3" onchange="selectRadio(this)">
                            <span>üîÑ Both counseling and medication</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Therapist Preferences -->
            <div class="glass-card">
                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">6</span>
                        <h2 class="text-xl font-bold text-white">Do you have any preferences for your therapist?</h2>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2 text-purple-300">üë§ Gender Preference</label>
                        <select name="therapist_gender" class="form-select">
                            <option value="no_preference">No preference</option>
                            <option value="female">Female</option>
                            <option value="male">Male</option>
                            <option value="non_binary">Non-binary</option>
                        </select>
                    </div>
                    
                    <div class="highlight-box mt-4">
                        <div class="flex items-center">
                            <i class="fas fa-video text-blue-400 mr-3 text-xl"></i>
                            <div>
                                <h4 class="font-semibold text-blue-200 mb-1">Virtual Sessions Only</h4>
                                <p class="text-blue-100 text-sm">
                                    All therapy sessions are conducted via secure Zoom meetings
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Safety Assessment -->
            <div class="glass-card">
                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">7</span>
                        <h2 class="text-xl font-bold text-white">Safety Assessment (Confidential)</h2>
                    </div>
                    <p class="text-purple-300 mb-4">
                        üîí This information helps us provide appropriate support and is completely confidential
                    </p>
                    <div class="space-y-3">
                        <label class="checkbox-option cursor-pointer">
                            <input type="checkbox" name="crisis_indicators" value="suicidal_thoughts" class="mr-3" onchange="selectCheckbox(this)">
                            <span>‚ö†Ô∏è I have thoughts of hurting myself or ending my life</span>
                        </label>
                        <label class="checkbox-option cursor-pointer">
                            <input type="checkbox" name="crisis_indicators" value="harm_others" class="mr-3" onchange="selectCheckbox(this)">
                            <span>‚ö†Ô∏è I have thoughts of hurting someone else</span>
                        </label>
                        <label class="checkbox-option cursor-pointer">
                            <input type="checkbox" name="crisis_indicators" value="substance_crisis" class="mr-3" onchange="selectCheckbox(this)">
                            <span>‚ö†Ô∏è I'm struggling with substance use that feels out of control</span>
                        </label>
                        <label class="checkbox-option cursor-pointer">
                            <input type="checkbox" name="crisis_indicators" value="eating_crisis" class="mr-3" onchange="selectCheckbox(this)">
                            <span>‚ö†Ô∏è I'm having severe problems with eating that are affecting my health</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Crisis Warning -->
            <div id="crisis-warning" class="crisis-warning" style="display: none;">
                <div class="flex items-start">
                    <i class="fas fa-shield-alt text-red-300 mr-4 mt-1 text-xl"></i>
                    <div>
                        <h4 class="font-bold text-red-200 mb-3 text-lg">üÜò Immediate Support Available</h4>
                        <p class="mb-4 text-red-100">If you're having thoughts of suicide or self-harm, please reach out for immediate help:</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="font-semibold text-red-200 mb-2">24/7 Crisis Support:</p>
                                <ul class="space-y-1 text-red-100">
                                    <li>üìû National Suicide Prevention: <strong>988</strong></li>
                                    <li>üí¨ Crisis Text Line: <strong>Text HOME to 741741</strong></li>
                                    <li>üö® Emergency Services: <strong>911</strong></li>
                                </ul>
                            </div>
                            <div>
                                <p class="font-semibold text-red-200 mb-2">Campus Resources:</p>
                                <ul class="space-y-1 text-red-100">
                                    <li>üè´ Campus counseling: Available 24/7</li>
                                    <li>üè• Student health services</li>
                                    <li>üë• Peer support groups</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Emergency Contact -->
            <div class="glass-card">
                <div class="form-section">
                    <div class="section-header">
                        <span class="section-number">8</span>
                        <h2 class="text-xl font-bold text-white">Emergency Contact Information</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-purple-300">üë§ Contact Name</label>
                            <input type="text" name="emergency_contact_name" placeholder="Full Name" 
                                   class="form-input" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2 text-purple-300">üì± Phone Number</label>
                            <input type="tel" name="emergency_contact_phone" placeholder="+254..." 
                                   class="form-input" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium mb-2 text-purple-300">ü§ù Relationship</label>
                            <input type="text" name="emergency_contact_relationship" placeholder="e.g., Parent, Sibling, Friend" 
                                   class="form-input" required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="glass-card text-center">
                <button type="submit" class="btn-primary" id="submit-btn">
                    <i class="fas fa-brain mr-2"></i>
                    Complete Assessment & Get Matched
                </button>
                <p class="text-sm text-purple-300 mt-4">
                    ‚ö° Instant AI matching ‚Ä¢ üìÖ Automatic session scheduling ‚Ä¢ üîí Complete privacy
                </p>
                
                <div class="highlight-box mt-4 max-w-md mx-auto">
                    <h4 class="font-semibold text-blue-200 mb-2">
                        <i class="fas fa-magic mr-2"></i>What Happens Next?
                    </h4>
                    <div class="text-blue-100 text-sm space-y-1">
                        <p>‚úÖ AI analyzes your responses instantly</p>
                        <p>‚úÖ Perfect therapist match found automatically</p>
                        <p>‚úÖ First session scheduled immediately</p>
                        <p>‚úÖ Secure meeting link sent to your email</p>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        let currentSeverity = null;

        // Severity Scale Selection
        function setSeverity(value) {
            currentSeverity = value;
            document.getElementById('severity-input').value = value;
            
            // Update button styles
            document.querySelectorAll('.severity-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-value="${value}"]`).classList.add('active');
            
            updateProgress();
        }

        // Radio button selection
        function selectRadio(element) {
            const parent = element.closest('.glass-card');
            parent.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('selected'));
            element.closest('.radio-option').classList.add('selected');
            updateProgress();
        }

        // Checkbox selection
        function selectCheckbox(element) {
            const parent = element.closest('.checkbox-option');
            if (element.checked) {
                parent.classList.add('selected');
            } else {
                parent.classList.remove('selected');
            }
            checkCrisisIndicators();
            updateProgress();
        }

        // Crisis Detection
        function checkCrisisIndicators() {
            const warningDiv = document.getElementById('crisis-warning');
            const checkedBoxes = document.querySelectorAll('input[name="crisis_indicators"]:checked');
            
            if (checkedBoxes.length > 0) {
                warningDiv.style.display = 'block';
            } else {
                warningDiv.style.display = 'none';
            }
        }

        // Update progress bar
        function updateProgress() {
            const totalFields = 8;
            let completedFields = 0;
            
            // Check each section
            if (document.querySelector('select[name="primary_concern"]').value) completedFields++;
            if (document.querySelector('textarea[name="description"]').value.trim()) completedFields++;
            if (document.getElementById('severity-input').value) completedFields++;
            if (document.querySelector('select[name="duration"]').value) completedFields++;
            if (document.querySelector('input[name="previous_therapy"]:checked')) completedFields++;
            if (document.querySelector('select[name="therapist_gender"]').value) completedFields++;
            if (document.querySelector('input[name="emergency_contact_name"]').value.trim()) completedFields++;
            if (document.querySelector('input[name="emergency_contact_phone"]').value.trim()) completedFields++;
            
            const progress = (completedFields / totalFields) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }

        // Show flash message
        function showFlashMessage(message, type = 'info') {
            const flashContainer = document.createElement('div');
            flashContainer.className = `flash-message flash-${type}`;
            flashContainer.innerHTML = `<p>${message}</p>`;
            
            const container = document.querySelector('.container');
            container.insertBefore(flashContainer, container.firstChild);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                flashContainer.remove();
            }, 5000);
        }

        // Form Submission
        document.getElementById('intake-form').addEventListener('submit', function(e) {
            // Check if all required fields are filled
            const requiredFields = ['primary_concern', 'description', 'severity', 'duration', 'previous_therapy', 'emergency_contact_name', 'emergency_contact_phone', 'emergency_contact_relationship'];
            let allValid = true;
            
            requiredFields.forEach(field => {
                if (field === 'previous_therapy') {
                    if (!document.querySelector('input[name="previous_therapy"]:checked')) {
                        allValid = false;
                    }
                } else {
                    const element = document.querySelector(`[name="${field}"], #${field}-input`);
                    if (!element || !element.value.trim()) {
                        allValid = false;
                    }
                }
            });
            
            if (!allValid) {
                e.preventDefault();
                showFlashMessage('Please complete all required fields before submitting.', 'error');
                return;
            }
            
            // Show loading state
            const submitBtn = document.getElementById('submit-btn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing Assessment...';
            submitBtn.disabled = true;
            
            // Check for crisis indicators
            const checkedCrisis = document.querySelectorAll('input[name="crisis_indicators"]:checked');
            const severity = parseInt(document.getElementById('severity-input').value);
            
            if (severity >= 8 || checkedCrisis.length > 0) {
                if (!confirm('üö® Based on your responses, we recommend priority assignment to a counselor. Would you like to proceed with immediate matching?')) {
                    e.preventDefault();
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }
            }
            
            // Show processing steps
            setTimeout(() => {
                submitBtn.innerHTML = '<i class="fas fa-brain mr-2"></i>Analyzing Responses...';
            }, 1000);
            
            setTimeout(() => {
                submitBtn.innerHTML = '<i class="fas fa-user-md mr-2"></i>Finding Therapist Match...';
            }, 2000);
            
            setTimeout(() => {
                submitBtn.innerHTML = '<i class="fas fa-calendar mr-2"></i>Scheduling Session...';
            }, 3000);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for progress tracking
            document.querySelectorAll('input, select, textarea').forEach(element => {
                element.addEventListener('change', updateProgress);
                element.addEventListener('input', updateProgress);
            });
            
            // Initial progress update
            updateProgress();
            
            console.log('Simplified wellbeing assessment loaded');
        });
    </script>
</body>
</html>