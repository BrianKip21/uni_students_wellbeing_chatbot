<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wellness Tracker - Wellbeing Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d1b69 100%);
            color: #e0e7ff;
            min-height: 100vh;
        }
        
        .sidebar {
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            z-index: 1000;
        }
        
        .sidebar-nav a {
            color: #a78bfa;
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            border-radius: 0 20px 20px 0;
            margin-right: 1rem;
        }
        
        .sidebar-nav a:hover {
            background: rgba(139, 92, 246, 0.2);
            color: #c4b5fd;
            transform: translateX(8px);
        }
        
        .sidebar-nav a.active {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        
        .main-content {
            margin-left: 260px;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            padding: 1.5rem;
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }
        
        .glass-card h3 {
            color: #e0e7ff;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        /* Page header styling */
        .page-header h2 {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .page-header p {
            color: #a78bfa;
            font-size: 1.125rem;
            margin-bottom: 2rem;
        }
        
        /* Flash messages styling */
        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-left: 4px solid #ef4444;
            color: #fca5a5;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-left: 4px solid #10b981;
            color: #6ee7b7;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        
        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-left: 4px solid #f59e0b;
            color: #fbbf24;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        
        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-left: 4px solid #3b82f6;
            color: #93c5fd;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        
        /* Tab navigation */
        .tab-navigation {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }
        
        .tab {
            color: #a78bfa;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }
        
        .tab:hover {
            color: #c4b5fd;
            background: rgba(139, 92, 246, 0.1);
        }
        
        .tab-active {
            border-bottom: 3px solid #8b5cf6;
            color: #e0e7ff;
            background: rgba(139, 92, 246, 0.2);
        }
        
        /* Button styles */
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            color: #e0e7ff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #8b5cf6;
            transform: translateY(-2px);
            color: #e0e7ff;
            text-decoration: none;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .btn-increment {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            color: #93c5fd;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }
        
        .btn-increment:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            transform: translateY(-2px);
            color: #bfdbfe;
            text-decoration: none;
        }
        
        /* Enhanced Mood Tracking Styles */
        .streak-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(245, 158, 11, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 12px;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .mood-summary {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 1.5rem;
            background: rgba(16, 185, 129, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .mood-icon-large i {
            font-size: 4rem;
        }
        
        .intensity-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .intensity-dots {
            display: flex;
            gap: 2px;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .dot.filled {
            background: #10b981;
        }
        
        .mood-triggers-display {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .trigger-tag {
            background: rgba(139, 92, 246, 0.2);
            color: #c4b5fd;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        
        .mood-buttons-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .mood-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem 1rem;
            color: #e0e7ff;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        
        .mood-btn:hover {
            transform: translateY(-2px);
            border-color: rgba(139, 92, 246, 0.5);
        }
        
        .mood-btn.selected {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }
        
        .mood-btn.happy.selected { border-color: #10b981; background: rgba(16, 185, 129, 0.2); }
        .mood-btn.neutral.selected { border-color: #6b7280; background: rgba(107, 114, 128, 0.2); }
        .mood-btn.sad.selected { border-color: #3b82f6; background: rgba(59, 130, 246, 0.2); }
        .mood-btn.anxious.selected { border-color: #f59e0b; background: rgba(245, 158, 11, 0.2); }
        .mood-btn.energetic.selected { border-color: #8b5cf6; background: rgba(139, 92, 246, 0.2); }
        
        .intensity-slider-container {
            position: relative;
            margin: 1rem 0;
        }
        
        .mood-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }
        
        .mood-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #8b5cf6;
            cursor: pointer;
            border: 2px solid white;
        }
        
        .intensity-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
        }
        
        .triggers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .trigger-pill {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            color: #c4b5fd;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .trigger-pill:hover {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }
        
        .trigger-pill.selected {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.2);
            color: #e0e7ff;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .insight-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .insight-icon {
            font-size: 1.5rem;
        }
        
        .mood-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 1rem;
        }
        
        .mood-day {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 40px;
        }
        
        .mood-day:hover {
            transform: scale(1.05);
        }
        
        .day-number {
            font-size: 0.75rem;
            color: #a78bfa;
            margin-bottom: 2px;
        }
        
        .mood-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .mood-indicator.mood-happy { background: #10b981; }
        .mood-indicator.mood-neutral { background: #6b7280; }
        .mood-indicator.mood-sad { background: #3b82f6; }
        .mood-indicator.mood-anxious { background: #f59e0b; }
        .mood-indicator.mood-energetic { background: #8b5cf6; }
        
        .mood-legend {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #a78bfa;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .legend-color.mood-happy { background: #10b981; }
        .legend-color.mood-neutral { background: #6b7280; }
        .legend-color.mood-sad { background: #3b82f6; }
        .legend-color.mood-anxious { background: #f59e0b; }
        .legend-color.mood-energetic { background: #8b5cf6; }

        /* Form elements */
        .form-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: #e0e7ff;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .form-input::placeholder {
            color: #a78bfa;
        }

        .form-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: #e0e7ff;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-textarea {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 1rem;
            color: #e0e7ff;
            transition: all 0.3s ease;
            width: 100%;
            min-height: 100px;
            resize: vertical;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .form-textarea::placeholder {
            color: #a78bfa;
        }

        .form-label {
            color: #c4b5fd;
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: block;
        }

        .view-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            color: #a78bfa;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .view-toggle:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #c4b5fd;
        }
        
        .view-toggle.active {
            background: rgba(139, 92, 246, 0.3);
            border-color: #8b5cf6;
            color: #e0e7ff;
        }
        
        /* Animation for progressive reveal */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
            display: none;
        }
        
        .fade-in.show {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        /* Journal Styles */
        .journal-summary {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .prompts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
        }

        .prompt-pill {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            color: #c4b5fd;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .prompt-pill:hover, .prompt-pill.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
        }

        .gratitude-display {
            background: rgba(236, 72, 153, 0.05);
            border: 1px solid rgba(236, 72, 153, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .gratitude-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .journal-entry-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .journal-entry-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        /* Goals Styles */
        .achievement-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(245, 158, 11, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 12px;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .goal-card-enhanced {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .goal-card-enhanced:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .goal-category {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .category-emoji {
            font-size: 1.25rem;
        }

        .goal-actions {
            display: flex;
            gap: 0.5rem;
        }

        .goal-title {
            font-weight: 600;
            color: #e0e7ff;
            margin-bottom: 1rem;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .progress-complete {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .progress-active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .goal-completed {
            display: flex;
            align-items: center;
            margin-top: 1rem;
            padding: 0.5rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 8px;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .category-progress-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .category-icon {
            font-size: 2rem;
        }

        .mini-progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .mini-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            transition: width 0.3s ease;
        }

        /* Summary/Insights Styles */
        .wellness-score-container {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #8b5cf6 0deg, #3b82f6 120deg, #10b981 240deg, #8b5cf6 360deg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            inset: 8px;
            border-radius: 50%;
            background: rgba(15, 15, 35, 0.9);
        }

        .score-number {
            font-size: 2rem;
            font-weight: bold;
            color: #e0e7ff;
            z-index: 1;
        }

        .score-label {
            font-size: 0.75rem;
            color: #a78bfa;
            z-index: 1;
        }

        .score-breakdown {
            flex: 1;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .score-category {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .week-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .summary-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .recommendations-list {
            margin-bottom: 1rem;
        }

        .recommendation-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .recommendation-action {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 6px;
            padding: 0.25rem 0.75rem;
            color: #c4b5fd;
            font-size: 0.75rem;
            margin-top: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recommendation-action:hover {
            background: rgba(139, 92, 246, 0.3);
            border-color: #8b5cf6;
        }

        .patterns-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .pattern-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1rem;
        }

        .pattern-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .mood-buttons-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .triggers-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .insights-grid {
                grid-template-columns: 1fr;
            }

            .sidebar {
                transform: translateX(-100%);
            }
            
            .main-content {
                margin-left: 0;
            }

            .wellness-score-container {
                flex-direction: column;
                text-align: center;
            }
            
            .goals-grid {
                grid-template-columns: 1fr;
            }
            
            .prompts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="p-6">
            <h1 class="text-2xl font-bold mb-8 bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">
                Wellbeing Assistant
            </h1>
        </div>
        <nav class="sidebar-nav">
            <ul class="space-y-2">
                <li><a href="{{ url_for('dashboard.index') }}" class="flex items-center">
                    <i class="fas fa-chart-line w-5 mr-3"></i> Dashboard
                </a></li>
                <li><a href="{{ url_for('tracking.index') }}" class="flex items-center active">
                    <i class="fas fa-chart-bar w-5 mr-3"></i> Wellness Tracker
                </a></li>
                <li><a href="{{ url_for('chatbot.chatbot_page') }}" class="flex items-center">
                    <i class="fas fa-comments w-5 mr-3"></i> AI Chat
                </a></li>
                <li><a href="{{ url_for('dashboard.therapist_info') }}" class="flex items-center">
                    <i class="fas fa-user-md w-5 mr-3"></i> Your Therapist
                </a></li>
                <li><a href="{{ url_for('dashboard.student_chat') }}" class="flex items-center">
                    <i class="fas fa-comments w-5 mr-3"></i> Chat with Therapist
                </a></li>
                <li><a href="{{ url_for('dashboard.profile') }}" class="flex items-center">
                    <i class="fas fa-user w-5 mr-3"></i> Profile
                </a></li>
                <li><a href="{{ url_for('dashboard.student_resources') }}" class="flex items-center">
                    <i class="fas fa-book w-5 mr-3"></i> Resources
                </a></li>
                <li><a href="{{ url_for('dashboard.settings') }}" class="flex items-center">
                    <i class="fas fa-cog w-5 mr-3"></i> Settings
                </a></li>
            </ul>
            
            <div class="mt-auto p-6">
                <a href="{{ url_for('auth.logout') }}" class="flex items-center text-red-400 hover:text-red-300">
                    <i class="fas fa-sign-out-alt w-5 mr-3"></i> Logout
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="max-w-6xl mx-auto">
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert-{{ category }}" role="alert">
                            <p>{{ message }}</p>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            <!-- Page Header -->
            <div class="page-header mb-8">
                <h2>Wellness Tracker</h2>
                <p>Track your mood, build habits, and achieve your wellness goals</p>
            </div>

            <!-- Navigation Tabs -->
            <div class="tab-navigation flex">
                <button class="tab tab-active" data-tab="mood">
                    <i class="far fa-smile mr-2"></i> Mood
                </button>
                <button class="tab" data-tab="journal">
                    <i class="far fa-edit mr-2"></i> Journal
                </button>
                <button class="tab" data-tab="goals">
                    <i class="fas fa-bullseye mr-2"></i> Goals
                </button>
                <button class="tab" data-tab="insights">
                    <i class="fas fa-chart-line mr-2"></i> Summary
                </button>
            </div>
            
            <!-- Enhanced Mood Tracking Section -->
            <div id="mood-section" class="tab-content">
                <!-- Quick Mood Check-in -->
                <div class="glass-card mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">How are you feeling?</h3>
                        {% if mood_streak and mood_streak > 1 %}
                            <div class="streak-badge">
                                <i class="fas fa-fire text-orange-400"></i>
                                <span class="text-sm text-orange-300">{{ mood_streak }} day streak!</span>
                            </div>
                        {% endif %}
                    </div>
                    
                    {% if user_already_tracked_mood_today %}
                        <!-- Today's Mood Display -->
                        <div class="mood-summary">
                            <div class="mood-icon-large">
                                {% if today_mood.mood == 'happy' %}
                                    <i class="far fa-smile text-green-400"></i>
                                {% elif today_mood.mood == 'neutral' %}
                                    <i class="far fa-meh text-gray-400"></i>
                                {% elif today_mood.mood == 'sad' %}
                                    <i class="far fa-frown text-blue-400"></i>
                                {% elif today_mood.mood == 'anxious' %}
                                    <i class="far fa-grimace text-yellow-500"></i>
                                {% elif today_mood.mood == 'energetic' %}
                                    <i class="far fa-grin-stars text-purple-400"></i>
                                {% endif %}
                            </div>
                            <div class="mood-details">
                                <h4 class="text-lg font-semibold capitalize text-green-300">{{ today_mood.mood }}</h4>
                                {% if today_mood.intensity %}
                                    <div class="intensity-display">
                                        <span class="text-sm text-gray-300">Intensity: </span>
                                        <div class="intensity-dots">
                                            {% for i in range(1, 11) %}
                                                <div class="dot {{ 'filled' if i <= today_mood.intensity else '' }}"></div>
                                            {% endfor %}
                                        </div>
                                        <span class="text-sm text-gray-300">{{ today_mood.intensity }}/10</span>
                                    </div>
                                {% endif %}
                                {% if today_mood.triggers %}
                                    <div class="mood-triggers-display">
                                        {% for trigger in today_mood.triggers %}
                                            <span class="trigger-tag">{{ trigger|title }}</span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                {% if today_mood.context %}
                                    <div class="mt-2 text-sm text-purple-300 italic">
                                        "{{ today_mood.context }}"
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="mt-4 text-sm text-purple-300 text-center">
                            <i class="fas fa-clock mr-1"></i>
                            See you tomorrow for another check-in!
                        </div>
                    {% else %}
                        <!-- Enhanced Mood Tracking Form -->
                        <form action="{{ url_for('tracking.track_mood_route') }}" method="post" class="mood-tracking-form">
                            <!-- Simplified Mood Selection -->
                            <div class="mood-selection mb-6">
                                <div class="mood-buttons-grid">
                                    <button type="button" class="mood-btn happy" data-mood="happy">
                                        <i class="far fa-smile text-3xl text-green-400"></i>
                                        <span>Happy</span>
                                    </button>
                                    <button type="button" class="mood-btn neutral" data-mood="neutral">
                                        <i class="far fa-meh text-3xl text-gray-400"></i>
                                        <span>Okay</span>
                                    </button>
                                    <button type="button" class="mood-btn sad" data-mood="sad">
                                        <i class="far fa-frown text-3xl text-blue-400"></i>
                                        <span>Down</span>
                                    </button>
                                    <button type="button" class="mood-btn anxious" data-mood="anxious">
                                        <i class="far fa-grimace text-3xl text-yellow-500"></i>
                                        <span>Anxious</span>
                                    </button>
                                    <button type="button" class="mood-btn energetic" data-mood="energetic">
                                        <i class="far fa-grin-stars text-3xl text-purple-400"></i>
                                        <span>Energetic</span>
                                    </button>
                                </div>
                                <input type="hidden" name="mood" id="selected-mood" required>
                            </div>
                            
                            <!-- Mood Intensity Slider -->
                            <div class="mood-intensity mb-6 fade-in" id="intensity-section">
                                <label class="form-label">How intense is this feeling? (1-10)</label>
                                <div class="intensity-slider-container">
                                    <input type="range" name="intensity" id="intensity-slider" min="1" max="10" value="5" class="mood-slider">
                                    <div class="intensity-labels">
                                        <span class="text-xs text-gray-400">Mild</span>
                                        <span class="text-xs text-gray-400" id="intensity-value">5</span>
                                        <span class="text-xs text-gray-400">Intense</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Triggers -->
                            <div class="mood-triggers mb-6 fade-in" id="triggers-section">
                                <label class="form-label">What influenced this mood? (optional, select up to 3)</label>
                                <div class="triggers-grid">
                                    <button type="button" class="trigger-pill" data-trigger="work">
                                        <i class="fas fa-briefcase mr-1"></i>Work
                                    </button>
                                    <button type="button" class="trigger-pill" data-trigger="sleep">
                                        <i class="fas fa-bed mr-1"></i>Sleep
                                    </button>
                                    <button type="button" class="trigger-pill" data-trigger="exercise">
                                        <i class="fas fa-running mr-1"></i>Exercise
                                    </button>
                                    <button type="button" class="trigger-pill" data-trigger="social">
                                        <i class="fas fa-users mr-1"></i>Social
                                    </button>
                                    <button type="button" class="trigger-pill" data-trigger="weather">
                                        <i class="fas fa-cloud-sun mr-1"></i>Weather
                                    </button>
                                    <button type="button" class="trigger-pill" data-trigger="health">
                                        <i class="fas fa-heart mr-1"></i>Health
                                    </button>
                                    <button type="button" class="trigger-pill" data-trigger="family">
                                        <i class="fas fa-home mr-1"></i>Family
                                    </button>
                                    <button type="button" class="trigger-pill" data-trigger="stress">
                                        <i class="fas fa-exclamation-triangle mr-1"></i>Stress
                                    </button>
                                </div>
                                <input type="hidden" name="triggers" id="selected-triggers">
                            </div>
                            
                            <!-- Quick Note -->
                            <div class="quick-note mb-6 fade-in" id="note-section">
                                <label class="form-label">Quick note (optional)</label>
                                <input type="text" name="context" id="mood-note" placeholder="What's on your mind?" maxlength="100" class="form-input">
                            </div>
                            
                            <!-- Submit Button -->
                            <button type="submit" class="btn-primary w-full fade-in" id="submit-mood">
                                <i class="fas fa-check mr-2"></i>
                                Track My Mood
                            </button>
                        </form>
                    {% endif %}
                </div>

                <!-- Mood Insights Card -->
                <div class="glass-card mb-6">
                    <h3 class="text-xl font-semibold mb-4">Your Mood Insights</h3>
                    <div class="insights-grid">
                        {% for insight in mood_insights %}
                            <div class="insight-card">
                                <div class="insight-icon">
                                    <i class="{{ insight.icon }} {{ insight.color }}"></i>
                                </div>
                                <div class="insight-content">
                                    <h4 class="font-medium text-purple-200">{{ insight.title }}</h4>
                                    <p class="text-sm text-purple-300">{{ insight.description }}</p>
                                </div>
                            </div>
                        {% else %}
                            <div class="insight-card">
                                <div class="insight-icon">
                                    <i class="fas fa-chart-line text-blue-400"></i>
                                </div>
                                <div class="insight-content">
                                    <h4 class="font-medium text-purple-200">Getting Started</h4>
                                    <p class="text-sm text-purple-300">Track for a few days to see personalized insights!</p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Enhanced Mood History -->
                <div class="glass-card">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Recent Moods</h3>
                        <div class="flex space-x-2">
                            <button class="view-toggle active" id="week-view">7 Days</button>
                            <button class="view-toggle" id="month-view">30 Days</button>
                        </div>
                    </div>
                    
                    <!-- Mood Calendar Grid -->
                    <div class="mood-calendar-grid" id="mood-calendar">
                        {% if mood_history and mood_history|length > 0 %}
                            {% for mood in mood_history[:30] %}
                                <div class="mood-day" title="{{ mood.formatted_date }}: {{ mood.mood|title }}{% if mood.intensity %} ({{ mood.intensity }}/10){% endif %}{% if mood.triggers %} - {{ mood.triggers|join(', ')|title }}{% endif %}">
                                    <div class="day-number">{{ mood.day_number }}</div>
                                    <div class="mood-indicator mood-{{ mood.mood }}"></div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="col-span-7 text-center py-8">
                                <p class="text-purple-300">Start tracking to see your mood patterns!</p>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mood Legend -->
                    <div class="mood-legend mt-4">
                        <div class="legend-item">
                            <div class="legend-color mood-happy"></div>
                            <span>Happy</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color mood-neutral"></div>
                            <span>Okay</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color mood-sad"></div>
                            <span>Down</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color mood-anxious"></div>
                            <span>Anxious</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color mood-energetic"></div>
                            <span>Energetic</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Enhanced Journal Section -->
            <div id="journal-section" class="tab-content hidden">
                <!-- Quick Journal Entry -->
                <div class="glass-card mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Daily Reflection</h3>
                        {% if journal_streak and journal_streak > 1 %}
                            <div class="streak-badge">
                                <i class="fas fa-feather text-blue-400"></i>
                                <span class="text-sm text-blue-300">{{ journal_streak }} day writing streak!</span>
                            </div>
                        {% endif %}
                    </div>
                    
                    {% if user_already_journaled_today %}
                        <!-- Today's Journal Display -->
                        <div class="journal-summary">
                            <div class="flex items-start gap-4">
                                <div class="journal-icon">
                                    <i class="fas fa-book text-3xl text-blue-400"></i>
                                </div>
                                <div class="journal-details flex-1">
                                    <h4 class="text-lg font-semibold text-blue-300 mb-2">{{ today_journal.title }}</h4>
                                    <p class="text-purple-300 mb-3">{{ today_journal.content[:150] }}{% if today_journal.content|length > 150 %}...{% endif %}</p>
                                    
                                    {% if today_journal.gratitude %}
                                        <div class="gratitude-display">
                                            <h5 class="text-sm font-medium text-purple-200 mb-2">Today's Gratitude:</h5>
                                            <div class="gratitude-items">
                                                {% for item in today_journal.gratitude %}
                                                    <div class="gratitude-item">
                                                        <i class="fas fa-heart text-pink-400 mr-2"></i>
                                                        <span class="text-purple-300">{{ item }}</span>
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="mt-3 text-sm text-purple-400">
                                        <i class="fas fa-clock mr-1"></i>
                                        Written {{ today_journal.created_at.strftime('%I:%M %p') }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <!-- Enhanced Journal Form -->
                        <form action="{{ url_for('tracking.save_journal') }}" method="post" class="journal-form">
                            <!-- Quick Prompts -->
                            <div class="journal-prompts mb-4">
                                <label class="form-label">What would you like to write about?</label>
                                <div class="prompts-grid">
                                    <button type="button" class="prompt-pill" data-prompt="How was your day?">
                                        <i class="fas fa-sun mr-1"></i>My Day
                                    </button>
                                    <button type="button" class="prompt-pill" data-prompt="What am I grateful for?">
                                        <i class="fas fa-heart mr-1"></i>Gratitude
                                    </button>
                                    <button type="button" class="prompt-pill" data-prompt="What challenges did I face?">
                                        <i class="fas fa-mountain mr-1"></i>Challenges
                                    </button>
                                    <button type="button" class="prompt-pill" data-prompt="What did I learn today?">
                                        <i class="fas fa-lightbulb mr-1"></i>Lessons
                                    </button>
                                    <button type="button" class="prompt-pill" data-prompt="What are my goals for tomorrow?">
                                        <i class="fas fa-target mr-1"></i>Tomorrow
                                    </button>
                                    <button type="button" class="prompt-pill" data-prompt="How am I feeling right now?">
                                        <i class="fas fa-smile mr-1"></i>Feelings
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Title Input -->
                            <div class="mb-4">
                                <label for="journal-title" class="form-label">Title (optional)</label>
                                <input type="text" id="journal-title" name="title" placeholder="Give your entry a title..." maxlength="100" class="form-input">
                            </div>
                            
                            <!-- Main Content -->
                            <div class="mb-4">
                                <label for="journal-content" class="form-label">Your thoughts</label>
                                <textarea id="journal-content" name="content" rows="6" placeholder="Start writing..." maxlength="2000" required class="form-textarea"></textarea>
                                <div class="text-xs text-purple-400 mt-1">
                                    <span id="char-count">0</span>/2000 characters
                                </div>
                            </div>
                            
                            <!-- Quick Gratitude -->
                            <div class="mb-4">
                                <label class="form-label">Three things I'm grateful for today (optional)</label>
                                <div class="space-y-2">
                                    <input type="text" name="gratitude[]" placeholder="1. I'm grateful for..." maxlength="100" class="form-input">
                                    <input type="text" name="gratitude[]" placeholder="2. I'm grateful for..." maxlength="100" class="form-input">
                                    <input type="text" name="gratitude[]" placeholder="3. I'm grateful for..." maxlength="100" class="form-input">
                                </div>
                            </div>
                            
                            <!-- Submit -->
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save mr-2"></i>
                                Save Journal Entry
                            </button>
                        </form>
                    {% endif %}
                </div>

                <!-- Journal Insights -->
                <div class="glass-card mb-6">
                    <h3 class="text-xl font-semibold mb-4">Your Writing Insights</h3>
                    <div class="insights-grid">
                        {% for insight in journal_insights %}
                            <div class="insight-card">
                                <div class="insight-icon">
                                    <i class="{{ insight.icon }} {{ insight.color }}"></i>
                                </div>
                                <div class="insight-content">
                                    <h4 class="font-medium text-purple-200">{{ insight.title }}</h4>
                                    <p class="text-sm text-purple-300">{{ insight.description }}</p>
                                </div>
                            </div>
                        {% else %}
                            <div class="insight-card">
                                <div class="insight-icon">
                                    <i class="fas fa-pen-fancy text-blue-400"></i>
                                </div>
                                <div class="insight-content">
                                    <h4 class="font-medium text-purple-200">Start Writing</h4>
                                    <p class="text-sm text-purple-300">Begin journaling to unlock writing insights!</p>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Recent Entries -->
                <div class="glass-card">
                    <h3 class="text-xl font-semibold mb-4">Recent Entries</h3>
                    
                    {% if journal_entries and journal_entries|length > 0 %}
                        <div class="space-y-4">
                            {% for entry in journal_entries[:5] %}
                                <div class="journal-entry-card">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="font-medium text-purple-200">
                                            {{ entry.title or 'Untitled Entry' }}
                                        </h4>
                                        <span class="text-xs text-purple-400">{{ entry.formatted_date }}</span>
                                    </div>
                                    <p class="text-sm text-purple-300 mb-2">{{ entry.content[:120] }}{% if entry.content|length > 120 %}...{% endif %}</p>
                                    {% if entry.gratitude %}
                                        <div class="gratitude-mini">
                                            <i class="fas fa-heart text-pink-400 mr-1"></i>
                                            <span class="text-xs text-purple-400">{{ entry.gratitude|length }} gratitude note{{ 's' if entry.gratitude|length != 1 else '' }}</span>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-8">
                            <i class="fas fa-book-open text-4xl text-purple-400 mb-4"></i>
                            <p class="text-purple-300">No journal entries yet. Start writing to track your thoughts and growth!</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Enhanced Goals Section -->
            <div id="goals-section" class="tab-content hidden">
                <!-- Quick Goal Setting -->
                <div class="glass-card mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Your Wellness Goals</h3>
                        {% if total_goals_completed > 0 %}
                            <div class="achievement-badge">
                                <i class="fas fa-trophy text-yellow-400"></i>
                                <span class="text-sm text-yellow-300">{{ total_goals_completed }} goals completed!</span>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Goal Creation Form -->
                    <form action="{{ url_for('tracking.add_goal') }}" method="post" class="goal-form mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label">What's your goal?</label>
                                <input type="text" name="description" placeholder="e.g., Meditate for 10 minutes daily" maxlength="200" required class="form-input">
                            </div>
                            <div>
                                <label class="form-label">Category</label>
                                <select name="category" class="form-select" required>
                                    <option value="mindfulness">🧘 Mindfulness</option>
                                    <option value="fitness">💪 Fitness</option>
                                    <option value="sleep">😴 Sleep</option>
                                    <option value="nutrition">🥗 Nutrition</option>
                                    <option value="social">👥 Social</option>
                                    <option value="learning">📚 Learning</option>
                                    <option value="creative">🎨 Creative</option>
                                    <option value="other">✨ Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <div>
                                <label class="form-label">Target</label>
                                <input type="number" name="target" min="1" max="365" value="7" required class="form-input">
                            </div>
                            <div>
                                <label class="form-label">Unit</label>
                                <select name="unit" class="form-select" required>
                                    <option value="days">Days</option>
                                    <option value="times">Times</option>
                                    <option value="minutes">Minutes</option>
                                    <option value="hours">Hours</option>
                                    <option value="sessions">Sessions</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Timeframe</label>
                                <select name="timeframe" class="form-select" required>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="quarter">This Quarter</option>
                                </select>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn-primary mt-4">
                            <i class="fas fa-plus mr-2"></i>
                            Create Goal
                        </button>
                    </form>
                </div>

                <!-- Active Goals -->
                <div class="glass-card mb-6">
                    <h3 class="text-xl font-semibold mb-4">Active Goals</h3>
                    
                    {% if active_goals and active_goals|length > 0 %}
                        <div class="goals-grid">
                            {% for goal in active_goals %}
                                <div class="goal-card-enhanced" id="goal-{{ goal._id }}">
                                    <div class="goal-header">
                                        <div class="goal-category">
                                            <span class="category-emoji">{{ goal.category_emoji }}</span>
                                            <span class="category-name">{{ goal.category|title }}</span>
                                        </div>
                                        <div class="goal-actions">
                                            <button class="btn-increment" onclick="updateGoalProgress('{{ goal._id }}', 1)">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                            <button class="btn-danger" onclick="deleteGoal('{{ goal._id }}')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <h4 class="goal-title">{{ goal.description }}</h4>
                                    
                                    <div class="goal-progress">
                                        <div class="progress-header">
                                            <span class="progress-text">
                                                <span id="progress-{{ goal._id }}">{{ goal.progress }}</span> / {{ goal.target }} {{ goal.unit }}
                                            </span>
                                            <span class="progress-percentage">
                                                {{ ((goal.progress / goal.target * 100) | round | int) if goal.target > 0 else 0 }}%
                                            </span>
                                        </div>
                                        <div class="progress-bar">
                                            {% set progress_pct = ((goal.progress / goal.target * 100) | round | int) if goal.target > 0 else 0 %}
                                            {% if progress_pct > 100 %}{% set progress_pct = 100 %}{% endif %}
                                            <div class="progress-fill {{ 'progress-complete' if progress_pct >= 100 else 'progress-active' }}" 
                                                 style="width: {{ progress_pct }}%"></div>
                                        </div>
                                    </div>
                                    
                                    {% if goal.progress >= goal.target %}
                                        <div class="goal-completed">
                                            <i class="fas fa-check-circle text-green-400 mr-2"></i>
                                            <span class="text-green-300">Completed! 🎉</span>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="goal-timeframe">
                                        <i class="fas fa-calendar mr-1"></i>
                                        <span class="text-xs text-purple-400">{{ goal.timeframe|title }} goal</span>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-8">
                            <i class="fas fa-bullseye text-4xl text-purple-400 mb-4"></i>
                            <p class="text-purple-300">No active goals. Set your first wellness goal above!</p>
                        </div>
                    {% endif %}
                </div>

                <!-- Goal Categories Overview -->
                <div class="glass-card">
                    <h3 class="text-xl font-semibold mb-4">Category Progress</h3>
                    
                    <div class="categories-grid">
                        {% for category in goal_categories %}
                            <div class="category-progress-card">
                                <div class="category-icon">{{ category.emoji }}</div>
                                <div class="category-info">
                                    <h4 class="font-medium text-purple-200">{{ category.name }}</h4>
                                    <p class="text-sm text-purple-300">{{ category.active_count }} active</p>
                                    <div class="mini-progress-bar">
                                        <div class="mini-progress-fill" style="width: {{ category.completion_rate }}%"></div>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="col-span-full text-center py-4">
                                <p class="text-purple-300">Start setting goals to see category progress!</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Enhanced Summary/Insights Section -->
            <div id="insights-section" class="tab-content hidden">
                <!-- Overall Wellness Score -->
                <div class="glass-card mb-6">
                    <h3 class="text-xl font-semibold mb-4">Your Wellness Score</h3>
                    
                    <div class="wellness-score-container">
                        <div class="score-circle">
                            <div class="score-number">{{ wellness_score }}</div>
                            <div class="score-label">Wellness Score</div>
                        </div>
                        
                        <div class="score-breakdown">
                            <div class="score-item">
                                <div class="score-category">
                                    <i class="fas fa-smile text-green-400"></i>
                                    <span>Mood Tracking</span>
                                </div>
                                <div class="score-value">{{ mood_score }}/100</div>
                            </div>
                            
                            <div class="score-item">
                                <div class="score-category">
                                    <i class="fas fa-book text-blue-400"></i>
                                    <span>Journaling</span>
                                </div>
                                <div class="score-value">{{ journal_score }}/100</div>
                            </div>
                            
                            <div class="score-item">
                                <div class="score-category">
                                    <i class="fas fa-bullseye text-purple-400"></i>
                                    <span>Goal Progress</span>
                                </div>
                                <div class="score-value">{{ goals_score }}/100</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weekly Summary -->
                <div class="glass-card mb-6">
                    <h3 class="text-xl font-semibold mb-4">This Week's Highlights</h3>
                    
                    <div class="week-summary-grid">
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-calendar-check text-green-400"></i>
                            </div>
                            <div class="summary-content">
                                <h4 class="font-semibold">{{ days_tracked }}/7</h4>
                                <p class="text-sm text-purple-300">Days tracked this week</p>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-heart text-pink-400"></i>
                            </div>
                            <div class="summary-content">
                                <h4 class="font-semibold">{{ dominant_mood|title }}</h4>
                                <p class="text-sm text-purple-300">Most common mood</p>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-trophy text-yellow-400"></i>
                            </div>
                            <div class="summary-content">
                                <h4 class="font-semibold">{{ goals_completed_week }}</h4>
                                <p class="text-sm text-purple-300">Goals completed</p>
                            </div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-icon">
                                <i class="fas fa-pen text-blue-400"></i>
                            </div>
                            <div class="summary-content">
                                <h4 class="font-semibold">{{ journal_entries_week }}</h4>
                                <p class="text-sm text-purple-300">Journal entries</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personalized Recommendations -->
                <div class="glass-card mb-6">
                    <h3 class="text-xl font-semibold mb-4">Recommendations for You</h3>
                    
                    <div class="recommendations-list">
                        {% for recommendation in personalized_recommendations %}
                            <div class="recommendation-card">
                                <div class="recommendation-icon">
                                    <i class="{{ recommendation.icon }} {{ recommendation.color }}"></i>
                                </div>
                                <div class="recommendation-content">
                                    <h4 class="font-medium text-purple-200">{{ recommendation.title }}</h4>
                                    <p class="text-sm text-purple-300">{{ recommendation.description }}</p>
                                    {% if recommendation.action %}
                                        <button class="recommendation-action" onclick="{{ recommendation.action }}">
                                            {{ recommendation.action_text }}
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        {% else %}
                            <div class="text-center py-6">
                                <i class="fas fa-lightbulb text-3xl text-yellow-400 mb-3"></i>
                                <p class="text-purple-300">Keep tracking to unlock personalized recommendations!</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Export Options -->
                <div class="glass-card">
                    <h3 class="text-xl font-semibold mb-4">Export Your Data</h3>
                    <p class="text-purple-300 mb-4">Download your wellness data to share with healthcare providers or for your own records.</p>
                    
                    <div class="flex gap-4">
                        <a href="{{ url_for('tracking.export_mood_data') }}" class="btn-secondary">
                            <i class="fas fa-download mr-2"></i>
                            Download Mood Data (CSV)
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Enhanced JavaScript -->
    <script>
        // Navigation functions
        function goToMoodTracking() {
            const moodTab = document.querySelector('[data-tab="mood"]');
            if (moodTab) {
                moodTab.click();
                setTimeout(() => {
                    const moodSection = document.getElementById('mood-section');
                    if (moodSection) {
                        moodSection.scrollIntoView({ behavior: 'smooth' });
                    }
                }, 100);
            }
        }

        function goToJournal() {
            const journalTab = document.querySelector('[data-tab="journal"]');
            if (journalTab) {
                journalTab.click();
                setTimeout(() => {
                    const journalContent = document.getElementById('journal-content');
                    if (journalContent) {
                        journalContent.focus();
                    }
                }, 100);
            }
        }

        function goToGoals() {
            const goalsTab = document.querySelector('[data-tab="goals"]');
            if (goalsTab) {
                goalsTab.click();
                setTimeout(() => {
                    const goalsSection = document.getElementById('goals-section');
                    if (goalsSection) {
                        goalsSection.scrollIntoView({ behavior: 'smooth' });
                    }
                }, 100);
            }
        }

        function goToResources() {
            window.location.href = '/student_resources';
        }

        // Enhanced Tab Navigation
        document.addEventListener('DOMContentLoaded', function() {
            // Check hash for active tab on page load
            const hashTab = window.location.hash.substring(1);
            if (hashTab) {
                const tabButton = document.querySelector(`[data-tab="${hashTab}"]`);
                if (tabButton) {
                    activateTab(tabButton);
                }
            }
            
            // Tab switching
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    activateTab(tab);
                });
            });
            
            function activateTab(tab) {
                try {
                    const allTabs = document.querySelectorAll('.tab');
                    allTabs.forEach(t => t.classList.remove('tab-active'));
                    tab.classList.add('tab-active');
                    
                    const tabContents = document.querySelectorAll('.tab-content');
                    tabContents.forEach(content => content.classList.add('hidden'));
                    
                    const tabName = tab.getAttribute('data-tab');
                    const tabContent = document.getElementById(tabName + '-section');
                    
                    if (tabContent) {
                        tabContent.classList.remove('hidden');
                    }
                    
                    window.history.replaceState(null, null, `#${tabName}`);
                } catch (err) {
                    console.error('Error activating tab:', err);
                }
            }

            // Enhanced Mood Tracking
            const moodButtons = document.querySelectorAll('.mood-btn');
            const intensitySlider = document.getElementById('intensity-slider');
            const intensityValue = document.getElementById('intensity-value');
            const triggerPills = document.querySelectorAll('.trigger-pill');
            const selectedMoodInput = document.getElementById('selected-mood');
            const selectedTriggersInput = document.getElementById('selected-triggers');
            const intensitySection = document.getElementById('intensity-section');
            const triggersSection = document.getElementById('triggers-section');
            const noteSection = document.getElementById('note-section');
            const submitButton = document.getElementById('submit-mood');
            
            let selectedTriggers = [];
            
            // Mood selection with progressive reveal
            moodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    moodButtons.forEach(btn => btn.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedMoodInput.value = this.dataset.mood;
                    
                    setTimeout(() => showSection(intensitySection), 300);
                    setTimeout(() => showSection(triggersSection), 600);
                    setTimeout(() => showSection(noteSection), 900);
                    setTimeout(() => showSection(submitButton), 1200);
                });
            });
            
            // Intensity slider
            if (intensitySlider && intensityValue) {
                intensitySlider.addEventListener('input', function() {
                    intensityValue.textContent = this.value;
                });
            }
            
            // Trigger selection (max 3)
            triggerPills.forEach(pill => {
                pill.addEventListener('click', function() {
                    const trigger = this.dataset.trigger;
                    
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selectedTriggers = selectedTriggers.filter(t => t !== trigger);
                    } else {
                        if (selectedTriggers.length < 3) {
                            this.classList.add('selected');
                            selectedTriggers.push(trigger);
                        } else {
                            this.style.animation = 'shake 0.5s ease-in-out';
                            setTimeout(() => {
                                this.style.animation = '';
                            }, 500);
                        }
                    }
                    
                    selectedTriggersInput.value = selectedTriggers.join(',');
                });
            });
            
            function showSection(element) {
                if (element) {
                    element.classList.add('show');
                }
            }

            // Journal character counter
            const journalContent = document.getElementById('journal-content');
            const charCount = document.getElementById('char-count');
            
            if (journalContent && charCount) {
                journalContent.addEventListener('input', function() {
                    charCount.textContent = this.value.length;
                });
            }
            
            // Journal prompt pills
            const promptPills = document.querySelectorAll('.prompt-pill');
            promptPills.forEach(pill => {
                pill.addEventListener('click', function() {
                    const prompt = this.dataset.prompt;
                    if (journalContent) {
                        journalContent.value = prompt + '\n\n';
                        journalContent.focus();
                        if (charCount) {
                            charCount.textContent = journalContent.value.length;
                        }
                    }
                });
            });

            // View toggle for mood history
            const weekView = document.getElementById('week-view');
            const monthView = document.getElementById('month-view');
            
            if (weekView && monthView) {
                weekView.addEventListener('click', () => {
                    weekView.classList.add('active');
                    monthView.classList.remove('active');
                });
                
                monthView.addEventListener('click', () => {
                    monthView.classList.add('active');
                    weekView.classList.remove('active');
                });
            }
        });
        
        // Goal progress update via AJAX - FIXED API ENDPOINTS
        function updateGoalProgress(goalId, increment) {
            if (!goalId) return;
            
            const goalElement = document.getElementById(`goal-${goalId}`);
            if (goalElement) {
                goalElement.style.opacity = '0.7';
            }
            
            fetch('{{ url_for("tracking.api_update_goal_progress") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    goal_id: goalId,
                    increment: increment
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const progressElement = document.getElementById(`progress-${goalId}`);
                    if (progressElement) {
                        progressElement.textContent = data.new_progress;
                    }
                    
                    if (data.goal_completed) {
                        showGoalCelebration(goalId);
                    }
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    alert(data.error || 'Failed to update goal');
                }
                
                if (goalElement) {
                    goalElement.style.opacity = '1';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                if (goalElement) {
                    goalElement.style.opacity = '1';
                }
                alert('Failed to update goal. Please try again.');
            });
        }
        
        // Delete goal function - FIXED API ENDPOINT
        function deleteGoal(goalId) {
            if (!confirm('Are you sure you want to delete this goal?')) return;
            
            fetch('{{ url_for("tracking.api_delete_goal") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    goal_id: goalId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                } else {
                    alert(data.error || 'Failed to delete goal');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to delete goal. Please try again.');
            });
        }

        // Goal celebration animation
        function showGoalCelebration(goalId) {
            const goalElement = document.getElementById(`goal-${goalId}`);
            if (goalElement) {
                const celebration = document.createElement('div');
                celebration.innerHTML = '🎉 Goal Completed! 🎉';
                celebration.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(16, 185, 129, 0.9);
                    color: white;
                    padding: 1rem 2rem;
                    border-radius: 12px;
                    font-weight: bold;
                    z-index: 1000;
                    animation: celebrationPop 2s ease-out forwards;
                `;
                
                goalElement.style.position = 'relative';
                goalElement.appendChild(celebration);
                
                setTimeout(() => {
                    if (celebration.parentNode) {
                        celebration.parentNode.removeChild(celebration);
                    }
                }, 2000);
            }
        }

        // Add shake animation for trigger limit feedback
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
            @keyframes celebrationPop {
                0% { 
                    opacity: 0; 
                    transform: translate(-50%, -50%) scale(0.5); 
                }
                20% { 
                    opacity: 1; 
                    transform: translate(-50%, -50%) scale(1.1); 
                }
                100% { 
                    opacity: 0; 
                    transform: translate(-50%, -50%) scale(1); 
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>