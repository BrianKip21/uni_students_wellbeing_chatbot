<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wellness Tracker - Wellbeing Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d1b69 100%);
            color: #e0e7ff;
            min-height: 100vh;
        }
        
        .sidebar {
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            z-index: 1000;
        }
        
        .sidebar-nav a {
            color: #a78bfa;
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            border-radius: 0 20px 20px 0;
            margin-right: 1rem;
        }
        
        .sidebar-nav a:hover {
            background: rgba(139, 92, 246, 0.2);
            color: #c4b5fd;
            transform: translateX(8px);
        }
        
        .sidebar-nav a.active {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        
        .main-content {
            margin-left: 260px;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            padding: 1.5rem;
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }
        
        .glass-card h3 {
            color: #e0e7ff;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        /* Page header styling */
        .page-header h2 {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .page-header p {
            color: #a78bfa;
            font-size: 1.125rem;
            margin-bottom: 2rem;
        }
        
        /* Flash messages styling */
        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-left: 4px solid #ef4444;
            color: #fca5a5;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-left: 4px solid #10b981;
            color: #6ee7b7;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        
        /* Tab navigation */
        .tab-navigation {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }
        
        .tab {
            color: #a78bfa;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            background: none;
            border-left: none;
            border-right: none;
            border-top: none;
        }
        
        .tab:hover {
            color: #c4b5fd;
            background: rgba(139, 92, 246, 0.1);
        }
        
        .tab-active {
            border-bottom: 3px solid #8b5cf6;
            color: #e0e7ff;
            background: rgba(139, 92, 246, 0.2);
        }
        
        /* Button styles */
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            color: #e0e7ff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #8b5cf6;
            transform: translateY(-2px);
            color: #e0e7ff;
            text-decoration: none;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
            color: white;
            text-decoration: none;
        }
        
        .btn-increment {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            color: #93c5fd;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }
        
        .btn-increment:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            transform: translateY(-2px);
            color: #bfdbfe;
            text-decoration: none;
        }
        
        /* Mood buttons */
        .mood-button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
            color: #e0e7ff;
        }
        
        .mood-button:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .mood-button.happy:hover {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
        }
        
        .mood-button.neutral:hover {
            background: rgba(107, 114, 128, 0.2);
            border-color: #6b7280;
        }
        
        .mood-button.sad:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }
        
        .mood-button.stressed:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
        }
        
        .mood-button.energetic:hover {
            background: rgba(245, 158, 11, 0.2);
            border-color: #f59e0b;
        }
        
        .mood-button.anxious:hover {
            background: rgba(217, 119, 6, 0.2);
            border-color: #d97706;
        }
        
        .mood-button.relaxed:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: #6366f1;
        }
        
        .mood-button.tired:hover {
            background: rgba(139, 92, 246, 0.2);
            border-color: #8b5cf6;
        }
        
        /* Mood history cards */
        .mood-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .mood-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }
        
        .mood-happy { border-left: 4px solid #10b981; }
        .mood-neutral { border-left: 4px solid #6b7280; }
        .mood-sad { border-left: 4px solid #3b82f6; }
        .mood-stressed { border-left: 4px solid #ef4444; }
        .mood-energetic { border-left: 4px solid #f59e0b; }
        .mood-anxious { border-left: 4px solid #d97706; }
        .mood-relaxed { border-left: 4px solid #6366f1; }
        .mood-tired { border-left: 4px solid #8b5cf6; }
        
        /* Form elements */
        .form-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: #e0e7ff;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .form-input::placeholder {
            color: #a78bfa;
        }
        
        .form-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: #e0e7ff;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .form-textarea {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 1rem;
            color: #e0e7ff;
            transition: all 0.3s ease;
            width: 100%;
            min-height: 100px;
            resize: vertical;
        }
        
        .form-textarea:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .form-textarea::placeholder {
            color: #a78bfa;
        }
        
        .form-label {
            color: #c4b5fd;
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        /* Radio buttons */
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .radio-option {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        .radio-option:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #8b5cf6;
        }
        
        .radio-option input[type="radio"] {
            margin-right: 0.5rem;
            accent-color: #8b5cf6;
        }
        
        /* Progress bars */
        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.3s ease;
        }
        
        .progress-meditation {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        
        .progress-exercise {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .progress-sleep {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .progress-water {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
        }
        
        .progress-green {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .progress-blue {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        
        /* Goal cards */
        .goal-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .goal-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }
        
        /* Journal entries */
        .journal-entry {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .journal-entry:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }
        
        .journal-title {
            color: #e0e7ff;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .journal-meta {
            color: #a78bfa;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        .journal-preview {
            color: #c4b5fd;
            font-size: 0.875rem;
            line-height: 1.4;
        }
        
        /* Achievement cards */
        .achievement-card {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        
        .achievement-icon {
            color: #10b981;
            margin-right: 1rem;
            font-size: 1.25rem;
        }
        
        .achievement-text {
            color: #6ee7b7;
            font-weight: 500;
        }
        
        .achievement-meta {
            color: #34d399;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        
        /* Loading spinner */
        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid #8b5cf6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Chart container */
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
        }
        
        /* Celebration animation */
        @keyframes celebrate {
            0% { transform: scale(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .celebration-circle {
            position: absolute;
            border-radius: 50%;
            animation: celebrate 1s ease-out forwards;
        }
        
        /* View toggle buttons */
        .view-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            color: #a78bfa;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .view-toggle:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #c4b5fd;
        }
        
        .view-toggle.active {
            background: rgba(139, 92, 246, 0.3);
            border-color: #8b5cf6;
            color: #e0e7ff;
        }
        
        /* Responsive design */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        /* Dark mode compatibility */
        {% if settings and settings.theme_mode == 'dark' %}
        body {
            background: linear-gradient(135deg, #000000 0%, #1a1a3e 50%, #2d1b69 100%);
        }
        
        .glass-card {
            background: rgba(0, 0, 0, 0.3);
        }
        
        .sidebar {
            background: rgba(0, 0, 0, 0.9);
        }
        {% endif %}
        
        /* High contrast compatibility */
        {% if settings and settings.contrast == 'high' %}
        body {
            background: #000000 !important;
            color: #ffffff !important;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1) !important;
            border: 2px solid #ffffff !important;
        }
        
        .glass-card h3, .page-header h2 {
            color: #ffffff !important;
            -webkit-text-fill-color: #ffffff !important;
        }
        
        .form-input, .form-select, .form-textarea {
            background: rgba(255, 255, 255, 0.1) !important;
            border: 2px solid #ffffff !important;
            color: #ffffff !important;
        }
        {% endif %}
        
        /* Large text compatibility */
        {% if settings and settings.text_size == 'lg' %}
        body {
            font-size: 1.125rem !important;
        }
        
        .glass-card h3 {
            font-size: 1.375rem !important;
        }
        
        .page-header h2 {
            font-size: 2.25rem !important;
        }
        {% elif settings and settings.text_size == 'xl' %}
        body {
            font-size: 1.25rem !important;
        }
        
        .glass-card h3 {
            font-size: 1.5rem !important;
        }
        
        .page-header h2 {
            font-size: 2.5rem !important;
        }
        {% endif %}
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="p-6">
            <h1 class="text-2xl font-bold mb-8 bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">
                Wellbeing Assistant
            </h1>
        </div>
        <nav class="sidebar-nav">
            <ul class="space-y-2">
                <li><a href="{{ url_for('dashboard.index') }}" class="flex items-center">
                    <i class="fas fa-chart-line w-5 mr-3"></i> Dashboard
                </a></li>
                <li><a href="{{ url_for('tracking.index') }}" class="flex items-center active">
                    <i class="fas fa-chart-bar w-5 mr-3"></i> Wellness Tracker
                </a></li>
                <li><a href="{{ url_for('chatbot.chatbot_page') }}" class="flex items-center">
                    <i class="fas fa-comments w-5 mr-3"></i> AI Chat
                </a></li>
                <li><a href="{{ url_for('dashboard.therapist_info') }}" class="flex items-center">
                    <i class="fas fa-user-md w-5 mr-3"></i> Your Therapist
                </a></li>
                <li><a href="{{ url_for('dashboard.profile') }}" class="flex items-center">
                    <i class="fas fa-user w-5 mr-3"></i> Profile
                </a></li>
                <li><a href="{{ url_for('dashboard.student_resources') }}" class="flex items-center">
                    <i class="fas fa-book w-5 mr-3"></i> Resources
                </a></li>
                <li><a href="{{ url_for('dashboard.settings') }}" class="flex items-center">
                    <i class="fas fa-cog w-5 mr-3"></i> Settings
                </a></li>
            </ul>
            
            <div class="mt-auto p-6">
                <a href="{{ url_for('auth.logout') }}" class="flex items-center text-red-400 hover:text-red-300">
                    <i class="fas fa-sign-out-alt w-5 mr-3"></i> Logout
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="max-w-6xl mx-auto">
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert-{{ category }}" role="alert">
                            <p>{{ message }}</p>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            <!-- Page Header -->
            <div class="page-header mb-8">
                <h2>Wellness Tracker</h2>
                <p>Track your mood, habits, and set wellness goals</p>
            </div>

            <!-- Navigation Tabs -->
            <div class="tab-navigation flex">
                <button class="tab tab-active" data-tab="mood">
                    <i class="far fa-smile mr-2"></i> Mood
                </button>
                <button class="tab" data-tab="journal">
                    <i class="far fa-edit mr-2"></i> Journal
                </button>
                <button class="tab" data-tab="goals">
                    <i class="fas fa-bullseye mr-2"></i> Goals
                </button>
                <button class="tab" data-tab="insights">
                    <i class="fas fa-chart-line mr-2"></i> Summary
                </button>
            </div>
            
            <!-- Mood Tracking Section -->
            <div id="mood-section" class="tab-content">
                <!-- Today's Mood -->
                <div class="glass-card mb-8">
                    <h3 class="text-xl font-semibold mb-4">How are you feeling today?</h3>
                    <form action="{{ url_for('tracking.track_mood_route') }}" method="post" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3">
                        <button type="submit" name="mood" value="happy" class="mood-button happy">
                            <i class="far fa-smile text-3xl text-green-400 block mx-auto mb-2"></i>
                            <span class="block text-center font-medium">Happy</span>
                        </button>
                        <button type="submit" name="mood" value="neutral" class="mood-button neutral">
                            <i class="far fa-meh text-3xl text-gray-400 block mx-auto mb-2"></i>
                            <span class="block text-center font-medium">Neutral</span>
                        </button>
                        <button type="submit" name="mood" value="sad" class="mood-button sad">
                            <i class="far fa-frown text-3xl text-blue-400 block mx-auto mb-2"></i>
                            <span class="block text-center font-medium">Sad</span>
                        </button>
                        <button type="submit" name="mood" value="stressed" class="mood-button stressed">
                            <i class="far fa-tired text-3xl text-red-400 block mx-auto mb-2"></i>
                            <span class="block text-center font-medium">Stressed</span>
                        </button>
                        <button type="submit" name="mood" value="energetic" class="mood-button energetic">
                            <i class="far fa-grin-stars text-3xl text-yellow-400 block mx-auto mb-2"></i>
                            <span class="block text-center font-medium">Energetic</span>
                        </button>
                        <button type="submit" name="mood" value="anxious" class="mood-button anxious">
                            <i class="far fa-grimace text-3xl text-yellow-500 block mx-auto mb-2"></i>
                            <span class="block text-center font-medium">Anxious</span>
                        </button>
                        <button type="submit" name="mood" value="relaxed" class="mood-button relaxed">
                            <i class="far fa-grin-beam text-3xl text-indigo-400 block mx-auto mb-2"></i>
                            <span class="block text-center font-medium">Relaxed</span>
                        </button>
                        <button type="submit" name="mood" value="tired" class="mood-button tired">
                            <i class="far fa-dizzy text-3xl text-purple-400 block mx-auto mb-2"></i>
                            <span class="block text-center font-medium">Tired</span>
                        </button>
                        
                        <!-- Add context -->
                        <div class="col-span-2 md:col-span-4 lg:col-span-8 mt-4">
                            <label for="mood-context" class="form-label">What's on your mind? (optional)</label>
                            <textarea id="mood-context" name="context" rows="2" maxlength="500" class="form-textarea" placeholder="Share your thoughts..."></textarea>
                        </div>
                    </form>
                </div>

                <!-- Mood History -->
                <div class="glass-card mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Your Mood History</h3>
                        <div class="flex space-x-2">
                            <button class="view-toggle active" id="week-view">Week</button>
                            <button class="view-toggle" id="month-view">Month</button>
                        </div>
                    </div>
                    
                    {% if mood_history and mood_history|length > 0 %}
                        <!-- Week View -->
                        <div id="week-history" class="grid grid-cols-1 md:grid-cols-7 gap-4">
                            {% for mood in mood_history[:7] %}
                                <div class="mood-card mood-{{ mood.mood }}">
                                    <div class="text-lg font-medium text-purple-200">{{ mood.date }}</div>
                                    <div class="mt-2">
                                        {% if mood.mood == 'happy' %}
                                            <i class="far fa-smile text-2xl text-green-400"></i>
                                        {% elif mood.mood == 'neutral' %}
                                            <i class="far fa-meh text-2xl text-gray-400"></i>
                                        {% elif mood.mood == 'sad' %}
                                            <i class="far fa-frown text-2xl text-blue-400"></i>
                                        {% elif mood.mood == 'stressed' %}
                                            <i class="far fa-tired text-2xl text-red-400"></i>
                                        {% elif mood.mood == 'energetic' %}
                                            <i class="far fa-grin-stars text-2xl text-yellow-400"></i>
                                        {% elif mood.mood == 'anxious' %}
                                            <i class="far fa-grimace text-2xl text-yellow-500"></i>
                                        {% elif mood.mood == 'relaxed' %}
                                            <i class="far fa-grin-beam text-2xl text-indigo-400"></i>
                                        {% elif mood.mood == 'tired' %}
                                            <i class="far fa-dizzy text-2xl text-purple-400"></i>
                                        {% endif %}
                                    </div>
                                    <div class="mt-1 capitalize text-purple-200">{{ mood.mood }}</div>
                                    {% if mood.get('context') %}
                                        <div class="mt-1 text-xs text-purple-300 truncate" title="{{ mood.context }}">
                                            "{{ mood.context }}"
                                        </div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                        </div>
                        
                        <!-- Month View -->
                        <div id="month-history" class="hidden">
                            <div class="chart-container">
                                <canvas id="mood-chart" height="300"></canvas>
                            </div>
                        </div>
                    {% else %}
                        <p class="text-purple-300 text-center py-4">No mood data recorded yet. Start tracking your mood today!</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Journal Section -->
            <div id="journal-section" class="tab-content hidden">
                <div class="glass-card mb-8">
                    <h3 class="text-xl font-semibold mb-4">Daily Reflection</h3>
                    <form action="{{ url_for('tracking.save_journal') }}" method="post">
                        <div class="mb-4">
                            <label for="journal-date" class="form-label">Date</label>
                            <input type="date" id="journal-date" name="date" value="{{ today_date }}" class="form-input" style="width: auto;">
                        </div>
                        
                        <div class="mb-4">
                            <label for="journal-title" class="form-label">Title</label>
                            <input type="text" id="journal-title" name="title" placeholder="What's on your mind today?" maxlength="100" required class="form-input">
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">How are you feeling?</label>
                            <div class="radio-group">
                                {% for mood in ['happy', 'neutral', 'sad', 'stressed', 'energetic', 'anxious', 'relaxed', 'tired'] %}
                                    <label class="radio-option">
                                        <input type="radio" name="mood" value="{{ mood }}" {% if loop.first %}required{% endif %}>
                                        <span class="capitalize">{{ mood }}</span>
                                    </label>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="journal-content" class="form-label">Journal Entry</label>
                            <textarea id="journal-content" name="content" rows="8" placeholder="Write your thoughts here..." maxlength="5000" class="form-textarea"></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">What are you grateful for today?</label>
                            <div class="space-y-2">
                                <input type="text" name="gratitude[]" placeholder="I'm grateful for..." maxlength="200" class="form-input">
                                <input type="text" name="gratitude[]" placeholder="I'm grateful for..." maxlength="200" class="form-input">
                                <input type="text" name="gratitude[]" placeholder="I'm grateful for..." maxlength="200" class="form-input">
                            </div>
                        </div>
                        
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save mr-2"></i>
                            Save Journal Entry
                        </button>
                    </form>
                </div>
                
                <div class="glass-card">
                    <h3 class="text-xl font-semibold mb-4">Previous Entries</h3>
                    
                    {% if journal_entries and journal_entries|length > 0 %}
                        <div class="space-y-4">
                            {% for entry in journal_entries %}
                                <div class="journal-entry">
                                    <div class="flex justify-between items-start">
                                        <div class="journal-title">{{ entry.title }}</div>
                                        <div class="text-sm text-purple-300">{{ entry.date }}</div>
                                    </div>
                                    <div class="journal-meta">
                                        <span class="inline-block px-2 py-1 bg-purple-600 bg-opacity-30 rounded-full text-xs capitalize mr-2">{{ entry.mood }}</span>
                                        <span class="journal-preview">{{ entry.content|truncate(100) }}</span>
                                    </div>
                                    <div class="mt-2">
                                        <a href="{{ url_for('tracking.view_journal', entry_id=entry._id) }}" class="text-purple-400 hover:text-purple-300 text-sm">Read more</a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-purple-300 text-center py-4">No journal entries yet. Start journaling today!</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Goals Section -->
            <div id="goals-section" class="tab-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- Add New Goal -->
                    <div class="glass-card">
                        <h3 class="text-xl font-semibold mb-4">Set a New Goal</h3>
                        <form action="{{ url_for('tracking.add_goal') }}" method="post" id="goal-form">
                            <div class="mb-4">
                                <label for="goal-type" class="form-label">Goal Type</label>
                                <select id="goal-type" name="type" class="form-select" required>
                                    <option value="meditation">Meditation</option>
                                    <option value="exercise">Exercise</option>
                                    <option value="sleep">Sleep</option>
                                    <option value="water">Water Intake</option>
                                    <option value="reading">Reading</option>
                                    <option value="study">Study</option>
                                    <option value="custom">Custom Goal</option>
                                </select>
                            </div>
                            
                            <div id="custom-goal-field" class="mb-4 hidden">
                                <label for="custom-type" class="form-label">Custom Goal Name</label>
                                <input type="text" id="custom-type" name="custom_type" placeholder="e.g., Journaling" maxlength="50" class="form-input">
                            </div>
                            
                            <div class="mb-4">
                                <label for="goal-description" class="form-label">Description</label>
                                <input type="text" id="goal-description" name="description" placeholder="What do you want to achieve?" maxlength="500" required class="form-input">
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="goal-target" class="form-label">Target Value</label>
                                    <input type="number" id="goal-target" name="target" min="1" max="10000" value="1" placeholder="e.g., 30" required class="form-input">
                                </div>
                                
                                <div>
                                    <label for="goal-unit" class="form-label">Unit</label>
                                    <select id="goal-unit" name="unit" class="form-select" required>
                                        <option value="minutes">Minutes</option>
                                        <option value="hours">Hours</option>
                                        <option value="days">Days</option>
                                        <option value="times">Times</option>
                                        <option value="glasses">Glasses</option>
                                        <option value="steps">Steps</option>
                                        <option value="pages">Pages</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div id="custom-unit-field" class="mb-4 hidden">
                                <label for="custom-unit" class="form-label">Custom Unit</label>
                                <input type="text" id="custom-unit" name="custom_unit" placeholder="e.g., Chapters" maxlength="20" class="form-input">
                            </div>
                            
                            <div class="mb-4">
                                <label for="goal-frequency" class="form-label">Frequency</label>
                                <select id="goal-frequency" name="frequency" class="form-select" required>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn-success">
                                <i class="fas fa-plus mr-2"></i>
                                Add Goal
                            </button>
                        </form>
                    </div>
                    
                    <!-- Goal Summary -->
                    <div class="glass-card">
                        <h3 class="text-xl font-semibold mb-4">Goal Summary</h3>
                        
                        {% if goals and goals|length > 0 %}
                            <div class="space-y-6">
                                {% for goal in goals %}
                                    <div class="goal-card" id="goal-{{ goal._id }}">
                                        <div class="flex justify-between items-center mb-2">
                                            <div>
                                                <span class="font-medium capitalize text-purple-200">{{ goal.type }}</span>
                                                <span class="text-sm text-purple-300 ml-2">{{ goal.frequency }}</span>
                                            </div>
                                            <div class="text-sm text-purple-200">
                                                <span id="goal-progress-{{ goal._id }}">{{ goal.progress }}</span> / 
                                                <span>{{ goal.target }} {{ goal.unit }}</span>
                                            </div>
                                        </div>
                                        
                                        <div class="progress-bar mb-2">
                                            {% set goal_progress = goal.progress|int %}
                                            {% set goal_target = goal.target|int %}
                                            {% if goal_target > 0 %}
                                                {% set progress_pct = (goal_progress / goal_target * 100)|int %}
                                            {% else %}
                                                {% set progress_pct = 0 %}
                                            {% endif %}
                                            {% if progress_pct > 100 %}{% set progress_pct = 100 %}{% endif %}
                                            
                                            <div class="progress-fill {{ 'progress-green' if progress_pct >= 100 else 'progress-blue' }}" 
                                                 style="width: {{ progress_pct }}%"></div>
                                        </div>
                                        
                                        <div class="flex items-center justify-between">
                                            <p class="text-sm text-purple-300">{{ goal.description }}</p>
                                            
                                            <div class="flex space-x-2">
                                                <button type="button" class="btn-increment"
                                                        onclick="updateGoalProgress('{{ goal._id }}', 1)" aria-label="Increment progress">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                                <button type="button" class="btn-danger"
                                                        onclick="deleteGoal('{{ goal._id }}')" aria-label="Delete goal">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="text-purple-300 text-center py-4">No goals set yet. Create your first goal!</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Weekly Progress Section -->
                <div class="glass-card mb-8">
                    <h3 class="text-xl font-semibold mb-4">Weekly Progress</h3>
                    <p class="text-sm text-purple-300 mb-4">Your progress is automatically calculated based on your goals.</p>
                    
                    <div class="space-y-8">
                        <!-- Meditation Progress -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-purple-200 font-medium">Meditation Goals</span>
                                <span class="text-purple-200 font-medium">{{ user.progress.meditation }}%</span>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill progress-meditation" style="width: {{ user.progress.meditation }}%"></div>
                            </div>
                            <p class="text-xs text-purple-400 text-right">Progress updates automatically when you track goal progress</p>
                        </div>
                        
                        <!-- Exercise Progress -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-purple-200 font-medium">Exercise Goals</span>
                                <span class="text-purple-200 font-medium">{{ user.progress.exercise }}%</span>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill progress-exercise" style="width: {{ user.progress.exercise }}%"></div>
                            </div>
                            <p class="text-xs text-purple-400 text-right">Progress updates automatically when you track goal progress</p>
                        </div>
                        
                        <!-- Sleep Progress -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-purple-200 font-medium">Sleep Quality</span>
                                <span class="text-purple-200 font-medium">{{ user.progress.sleep }}%</span>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill progress-sleep" style="width: {{ user.progress.sleep }}%"></div>
                            </div>
                            <p class="text-xs text-purple-400 text-right">Progress updates automatically when you track goal progress</p>
                        </div>
                        
                        <!-- Water Intake Progress -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-purple-200 font-medium">Water Intake</span>
                                <span class="text-purple-200 font-medium">{{ user.progress.water }}%</span>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill progress-water" style="width: {{ user.progress.water }}%"></div>
                            </div>
                            <p class="text-xs text-purple-400 text-right">Progress updates automatically when you track goal progress</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Progress Summary Section -->
            <div id="insights-section" class="tab-content hidden">
                <!-- Overall Progress Summary -->
                <div class="glass-card mb-6">
                    <h3 class="text-xl font-semibold mb-4">Weekly Progress Summary</h3>
                    
                    <div class="space-y-6">
                        <!-- Meditation Progress -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-purple-200 font-medium">Meditation</span>
                                <span class="text-purple-200 font-medium">{{ user.progress.meditation }}%</span>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill progress-meditation" style="width: {{ user.progress.meditation }}%"></div>
                            </div>
                        </div>
                        
                        <!-- Exercise Progress -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-purple-200 font-medium">Exercise</span>
                                <span class="text-purple-200 font-medium">{{ user.progress.exercise }}%</span>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill progress-exercise" style="width: {{ user.progress.exercise }}%"></div>
                            </div>
                        </div>
                        
                        <!-- Sleep Progress -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-purple-200 font-medium">Sleep Quality</span>
                                <span class="text-purple-200 font-medium">{{ user.progress.sleep }}%</span>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill progress-sleep" style="width: {{ user.progress.sleep }}%"></div>
                            </div>
                        </div>
                        
                        <!-- Water Intake Progress -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-purple-200 font-medium">Water Intake</span>
                                <span class="text-purple-200 font-medium">{{ user.progress.water }}%</span>
                            </div>
                            
                            <div class="progress-bar">
                                <div class="progress-fill progress-water" style="width: {{ user.progress.water }}%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mood History Simple Overview -->
                <div class="glass-card mb-6">
                    <h3 class="text-xl font-semibold mb-4">Recent Mood History</h3>
                    
                    {% if mood_history and mood_history|length > 0 %}
                        <div class="grid grid-cols-1 md:grid-cols-7 gap-3">
                            {% for mood in mood_history[:7] %}
                                <div class="mood-card mood-{{ mood.mood }}">
                                    <div class="text-sm font-medium text-purple-200">{{ mood.date }}</div>
                                    <div class="mt-2">
                                        {% if mood.mood == 'happy' %}
                                            <i class="far fa-smile text-2xl text-green-400"></i>
                                        {% elif mood.mood == 'neutral' %}
                                            <i class="far fa-meh text-2xl text-gray-400"></i>
                                        {% elif mood.mood == 'sad' %}
                                            <i class="far fa-frown text-2xl text-blue-400"></i>
                                        {% elif mood.mood == 'stressed' %}
                                            <i class="far fa-tired text-2xl text-red-400"></i>
                                        {% elif mood.mood == 'energetic' %}
                                            <i class="far fa-grin-stars text-2xl text-yellow-400"></i>
                                        {% elif mood.mood == 'anxious' %}
                                            <i class="far fa-grimace text-2xl text-yellow-500"></i>
                                        {% elif mood.mood == 'relaxed' %}
                                            <i class="far fa-grin-beam text-2xl text-indigo-400"></i>
                                        {% elif mood.mood == 'tired' %}
                                            <i class="far fa-dizzy text-2xl text-purple-400"></i>
                                        {% endif %}
                                    </div>
                                    <div class="mt-1 capitalize text-sm text-purple-200">{{ mood.mood }}</div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-purple-300 text-center py-4">No mood data recorded yet. Start tracking your mood today!</p>
                    {% endif %}
                </div>
                
                <!-- Goal Achievement Summary -->
                <div class="glass-card">
                    <h3 class="text-xl font-semibold mb-4">Goal Achievement</h3>
                    
                    {% if goals and goals|length > 0 %}
                        {% set completed_goals = 0 %}
                        {% for goal in goals %}
                            {% if goal.progress|int >= goal.target|int %}
                                {% set completed_goals = completed_goals + 1 %}
                            {% endif %}
                        {% endfor %}
                        {% set total_goals = goals|length %}
                        
                        <div class="flex items-center mb-4">
                            <div class="progress-bar mr-2">
                                {% if total_goals > 0 %}
                                    {% set completion_rate = (completed_goals / total_goals * 100)|round|int %}
                                {% else %}
                                    {% set completion_rate = 0 %}
                                {% endif %}
                                <div class="progress-fill progress-green" style="width: {{ completion_rate }}%"></div>
                            </div>
                            <span class="text-sm font-medium text-purple-200">{{ completion_rate }}%</span>
                        </div>
                        
                        <p class="text-sm text-purple-300 mb-4">
                            You've completed {{ completed_goals }} out of {{ total_goals }} goals.
                        </p>
                        
                        <h4 class="font-medium text-purple-200 mb-2">Latest Achievements</h4>
                        <div class="space-y-3">
                            {% set achieved_goals = [] %}
                            {% for goal in goals %}
                                {% if goal.progress|int >= goal.target|int %}
                                    {% set _ = achieved_goals.append(goal) %}
                                {% endif %}
                            {% endfor %}
                            
                            {% for goal in achieved_goals[:3] %}
                                <div class="achievement-card">
                                    <i class="fas fa-check-circle achievement-icon"></i>
                                    <div>
                                        <p class="achievement-text">{{ goal.description }}</p>
                                        <p class="achievement-meta">{{ goal.target }} {{ goal.unit }} of {{ goal.type|capitalize }}</p>
                                    </div>
                                </div>
                            {% else %}
                                <p class="text-purple-300 text-center py-4">Complete goals to see your achievements here!</p>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-purple-300 text-center py-4">No goals set yet. Create your first goal!</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script>
        // Tab Navigation
        document.addEventListener('DOMContentLoaded', function() {
            // Check hash for active tab on page load
            const hashTab = window.location.hash.substring(1);
            if (hashTab) {
                const tabButton = document.querySelector(`[data-tab="${hashTab}"]`);
                if (tabButton) {
                    activateTab(tabButton);
                }
            }
            
            // Tab switching
            const tabs = document.querySelectorAll('.tab');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    activateTab(tab);
                });
            });
            
            function activateTab(tab) {
                try {
                    // Remove active class from all tabs
                    const allTabs = document.querySelectorAll('.tab');
                    allTabs.forEach(t => t.classList.remove('tab-active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('tab-active');
                    
                    // Hide all tab contents
                    const tabContents = document.querySelectorAll('.tab-content');
                    tabContents.forEach(content => content.classList.add('hidden'));
                    
                    // Show the corresponding tab content
                    const tabName = tab.getAttribute('data-tab');
                    const tabContent = document.getElementById(tabName + '-section');
                    
                    if (tabContent) {
                        tabContent.classList.remove('hidden');
                    } else {
                        console.error(`Tab content not found: ${tabName}-section`);
                    }
                    
                    // Update URL hash
                    window.history.replaceState(null, null, `#${tabName}`);
                } catch (err) {
                    console.error('Error activating tab:', err);
                }
            }
            
            // Toggle between week and month view in mood section
            const weekView = document.getElementById('week-view');
            const monthView = document.getElementById('month-view');
            const weekHistory = document.getElementById('week-history');
            const monthHistory = document.getElementById('month-history');
            
            if (weekView && monthView && weekHistory && monthHistory) {
                weekView.addEventListener('click', () => {
                    weekView.classList.add('active');
                    monthView.classList.remove('active');
                    
                    weekHistory.classList.remove('hidden');
                    monthHistory.classList.add('hidden');
                });
                
                monthView.addEventListener('click', () => {
                    monthView.classList.add('active');
                    weekView.classList.remove('active');
                    
                    monthHistory.classList.remove('hidden');
                    weekHistory.classList.add('hidden');
                    
                    // Initialize the chart if it's not already
                    initializeMoodChart();
                });
            }
            
            // Custom goal type toggle
            const goalTypeSelect = document.getElementById('goal-type');
            const customGoalField = document.getElementById('custom-goal-field');
            
            if (goalTypeSelect && customGoalField) {
                goalTypeSelect.addEventListener('change', () => {
                    if (goalTypeSelect.value === 'custom') {
                        customGoalField.classList.remove('hidden');
                        document.getElementById('custom-type').setAttribute('required', 'required');
                    } else {
                        customGoalField.classList.add('hidden');
                        document.getElementById('custom-type').removeAttribute('required');
                    }
                });
            }
            
            // Custom unit toggle
            const goalUnitSelect = document.getElementById('goal-unit');
            const customUnitField = document.getElementById('custom-unit-field');
            
            if (goalUnitSelect && customUnitField) {
                goalUnitSelect.addEventListener('change', () => {
                    if (goalUnitSelect.value === 'custom') {
                        customUnitField.classList.remove('hidden');
                        document.getElementById('custom-unit').setAttribute('required', 'required');
                    } else {
                        customUnitField.classList.add('hidden');
                        document.getElementById('custom-unit').removeAttribute('required');
                    }
                });
            }
            
            // Goal form validation
            const goalForm = document.getElementById('goal-form');
            if (goalForm) {
                goalForm.addEventListener('submit', function(event) {
                    const goalType = document.getElementById('goal-type').value;
                    const customType = document.getElementById('custom-type');
                    
                    if (goalType === 'custom' && customType && !customType.value.trim()) {
                        event.preventDefault();
                        alert('Please enter a custom goal type');
                        customType.focus();
                        return false;
                    }
                    
                    const unitType = document.getElementById('goal-unit').value;
                    const customUnit = document.getElementById('custom-unit');
                    
                    if (unitType === 'custom' && customUnit && !customUnit.value.trim()) {
                        event.preventDefault();
                        alert('Please enter a custom unit');
                        customUnit.focus();
                        return false;
                    }
                    
                    return true;
                });
            }
        });
        
        // Goal progress update via AJAX
        function updateGoalProgress(goalId, increment) {
            if (!goalId) {
                console.error('No goal ID provided');
                return;
            }
            
            // Show loading indicator
            const goalElement = document.getElementById(`goal-${goalId}`);
            if (goalElement) {
                // Add a loading spinner
                const progressElement = document.getElementById(`goal-progress-${goalId}`);
                if (progressElement) {
                    const originalContent = progressElement.innerHTML;
                    progressElement.innerHTML = '<div class="loading-spinner inline-block"></div>';
                }
                
                goalElement.classList.add('opacity-50');
            }
            
            // Make an AJAX call to update the goal
            fetch('{{ url_for("tracking.update_goal_progress_route") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    goal_id: goalId,
                    increment: increment
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Server responded with status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // Reload the page to update all progress indicators
                    // This ensures the weekly progress section is also updated
                    window.location.reload();
                } else {
                    // Remove loading indicator
                    if (goalElement) {
                        goalElement.classList.remove('opacity-50');
                    }
                    alert(data.error || 'Failed to update goal progress');
                }
            })
            .catch(error => {
                // Remove loading indicator
                if (goalElement) {
                    goalElement.classList.remove('opacity-50');
                    
                    // Restore original content
                    const progressElement = document.getElementById(`goal-progress-${goalId}`);
                    if (progressElement && progressElement.querySelector('.loading-spinner')) {
                        progressElement.textContent = "";
                    }
                }
                
                console.error('Error updating goal:', error);
                alert(`Failed to update goal: ${error.message}. Please try again.`);
            });
        }
        
        // Delete goal via AJAX
        function deleteGoal(goalId) {
            if (!goalId) {
                console.error('No goal ID provided');
                return;
            }
            
            if (confirm('Are you sure you want to delete this goal?')) {
                // Show loading indicator
                const goalElement = document.getElementById(`goal-${goalId}`);
                if (goalElement) {
                    goalElement.classList.add('opacity-50');
                }
                
                fetch('{{ url_for("tracking.delete_goal_route") }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        goal_id: goalId
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Server responded with status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        // Fade out and remove the goal element
                        if (goalElement) {
                            goalElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                            goalElement.style.opacity = '0';
                            goalElement.style.transform = 'translateY(-10px)';
                            
                            setTimeout(() => {
                                // Reload the page to update the weekly progress section
                                window.location.reload();
                            }, 300);
                        } else {
                            // Just reload if we can't find the element
                            window.location.reload();
                        }
                    } else {
                        // Remove loading indicator
                        if (goalElement) {
                            goalElement.classList.remove('opacity-50');
                        }
                        alert(data.error || 'Failed to delete goal');
                    }
                })
                .catch(error => {
                    // Remove loading indicator
                    if (goalElement) {
                        goalElement.classList.remove('opacity-50');
                    }
                    
                    console.error('Error deleting goal:', error);
                    alert(`Failed to delete goal: ${error.message}. Please try again.`);
                });
            }
        }
        
        // Goal celebration animation
        function showGoalCelebration(goalId) {
            // Create celebrating circles
            const goalElement = document.getElementById(`goal-${goalId}`);
            if (goalElement) {
                // Add a congratulatory message
                const message = document.createElement('div');
                message.className = 'text-green-400 font-medium text-sm mt-2 mb-2 text-center';
                message.textContent = '🎉 Goal achieved! Congratulations!';
                goalElement.appendChild(message);
                
                // Create celebration particles
                for (let i = 0; i < 12; i++) {
                    const circle = document.createElement('div');
                    circle.classList.add('celebration-circle');
                    
                    // Random position around the goal
                    const size = Math.random() * 20 + 10;
                    circle.style.width = `${size}px`;
                    circle.style.height = `${size}px`;
                    circle.style.backgroundColor = getRandomColor();
                    
                    // Position the circle
                    const top = Math.random() * 60 - 30;
                    const left = Math.random() * 100;
                    circle.style.top = `${top}%`;
                    circle.style.left = `${left}%`;
                    
                    // Delay the animation slightly
                    circle.style.animationDelay = `${i * 0.1}s`;
                    
                    goalElement.appendChild(circle);
                    
                    // Remove the circle after animation completes
                    setTimeout(() => {
                        circle.remove();
                    }, 1500 + i * 100);
                }
                
                // Remove the message after a delay
                setTimeout(() => {
                    message.style.transition = 'opacity 0.5s ease';
                    message.style.opacity = '0';
                    setTimeout(() => {
                        message.remove();
                    }, 500);
                }, 3000);
            }
        }
        
        // Helper function for random colors
        function getRandomColor() {
            const colors = [
                '#10B981', // Green
                '#3B82F6', // Blue
                '#F59E0B', // Yellow
                '#EF4444', // Red
                '#8B5CF6', // Purple
                '#EC4899', // Pink
                '#F97316'  // Orange
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // Initialize mood chart for the month view
        function initializeMoodChart() {
            try {
                const ctx = document.getElementById('mood-chart');
                if (!ctx) return;
                
                const ctxContext = ctx.getContext('2d');
                
                // Check if chart already exists
                if (ctx.chart) {
                    ctx.chart.destroy();
                }
                
                // Default data for the chart
                let moodData = {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [
                        {
                            label: 'Happy',
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1,
                            data: [3, 2, 4, 2]
                        },
                        {
                            label: 'Neutral',
                            backgroundColor: 'rgba(107, 114, 128, 0.2)',
                            borderColor: 'rgba(107, 114, 128, 1)',
                            borderWidth: 1,
                            data: [2, 3, 1, 3]
                        },
                        {
                            label: 'Sad',
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1,
                            data: [1, 1, 0, 2]
                        },
                        {
                            label: 'Stressed',
                            backgroundColor: 'rgba(239, 68, 68, 0.2)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1,
                            data: [1, 2, 2, 0]
                        }
                    ]
                };
                
                // Use custom data if available (added by backend)
                if (typeof moodChartData !== 'undefined') {
                    moodData = moodChartData;
                }
                
                ctx.chart = new Chart(ctxContext, {
                    type: 'bar',
                    data: moodData,
                    options: {
                        title: {
                            display: true,
                            text: 'Monthly Mood Distribution',
                            fontColor: '#e0e7ff'
                        },
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true,
                                    fontColor: '#a78bfa'
                                },
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Number of Days',
                                    fontColor: '#c4b5fd'
                                },
                                gridLines: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }],
                            xAxes: [{
                                ticks: {
                                    fontColor: '#a78bfa'
                                },
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Week',
                                    fontColor: '#c4b5fd'
                                },
                                gridLines: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }]
                        },
                        responsive: true,
                        maintainAspectRatio: false,
                        tooltips: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(15, 15, 35, 0.9)',
                            titleFontColor: '#e0e7ff',
                            bodyFontColor: '#c4b5fd',
                            borderColor: 'rgba(139, 92, 246, 0.5)',
                            borderWidth: 1,
                            callbacks: {
                                title: function(tooltipItems, data) {
                                    return tooltipItems[0].xLabel;
                                },
                                label: function(tooltipItem, data) {
                                    const datasetLabel = data.datasets[tooltipItem.datasetIndex].label || '';
                                    const value = tooltipItem.yLabel;
                                    return `${datasetLabel}: ${value} day${value !== 1 ? 's' : ''}`;
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                fontColor: '#c4b5fd'
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error initializing mood chart:', error);
            }
        }
        
        // Initialize page
        console.log('Modern wellness tracker loaded');
    </script>
</body>
</html>