<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register | Wellbeing Assistant</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #111827;
            padding: 20px;
        }

        .login-box {
            display: flex;
            justify-content: center;
            flex-direction: column;
            width: 100%;
            max-width: 600px;
            padding: 30px;
            background: #1f2937;
            border-radius: 10px;
            box-shadow: 0px 5px 15px rgba(0,0,0,0.2);
            color: #e0e0e0;
        }

        .login-header {
            text-align: center;
            margin: 20px 0 30px 0;
        }

        .login-header header {
            color: #e0e0e0;
            font-size: 28px;
            font-weight: 600;
        }

        .input-box .input-field, .input-box textarea {
            width: 100%;
            height: 50px;
            font-size: 16px;
            padding: 0 20px;
            margin-bottom: 15px;
            border-radius: 25px;
            border: 1px solid #4b5563;
            background-color: #374151;
            color: #e0e0e0;
            outline: none;
            transition: .3s;
            resize: none;
        }

        .input-box textarea {
            height: 80px;
            padding: 15px 20px;
            border-radius: 15px;
        }

        .input-field:focus, textarea:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }

        .input-box select {
            appearance: none;
            background: #374151;
            cursor: pointer;
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236B7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 1rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        ::placeholder {
            font-weight: 500;
            color: #9ca3af;
        }

        .error-message {
            color: #ef4444;
            font-size: 14px;
            display: none;
            margin-bottom: 10px;
        }

        .submit-btn {
            width: 100%;
            height: 50px;
            background: #4b5563;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: .3s;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .submit-btn:hover {
            background: #6b7280;
            transform: translateY(-2px);
        }

        .sign-up-link {
            text-align: center;
            font-size: 15px;
            margin-top: 20px;
            color: #9ca3af;
        }

        .sign-up-link a {
            color: #60a5fa;
            font-weight: 600;
            text-decoration: none;
        }
        
        .sign-up-link a:hover {
            text-decoration: underline;
        }
        
        .input-row {
            display: flex;
            gap: 10px;
        }
        
        .input-row .input-box {
            flex: 1;
        }

        .mock-data-btn {
            background: #059669;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 5px;
            transition: .3s;
        }

        .mock-data-btn:hover {
            background: #047857;
        }

        .dev-notice {
            background: #065f46;
            border: 1px solid #059669;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 12px;
            text-align: center;
        }

        .hidden {
            display: none;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
            padding: 15px;
            background: #374151;
            border-radius: 15px;
            border: 1px solid #4b5563;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #60a5fa;
        }

        .checkbox-item label {
            font-size: 14px;
            color: #e0e0e0;
            cursor: pointer;
        }

        .availability-grid {
            display: grid;
            gap: 15px;
            padding: 15px;
            background: #374151;
            border-radius: 15px;
            border: 1px solid #4b5563;
            margin: 10px 0;
        }

        .day-schedule {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .day-checkbox {
            min-width: 100px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .time-inputs {
            display: flex;
            gap: 10px;
            flex: 1;
        }

        .time-inputs input {
            height: 35px;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="login-box">
        <div class="login-header">
            <header>Register</header>
            <p class="text-gray-400 text-center mt-2">Create your account</p>
        </div>

        <!-- Development Notice -->
        <div class="dev-notice">
            <strong>Development Mode:</strong> Use mock data buttons for quick testing
        </div>

        <form id="registerForm" action="{{ url_for('auth.register') }}" method="POST" onsubmit="return validateForm()">
            <!-- Role Selection -->
            <div class="input-box">
                <select name="role" id="role" class="input-field" required onchange="toggleFields()">
                    <option value="" disabled selected>Select Role</option>
                    <option value="student">Student</option>
                    <option value="therapist">Therapist</option>
                </select>
                <button type="button" class="mock-data-btn" onclick="fillMockData()">Fill Mock Data</button>
            </div>

            <div class="input-row">
                <div class="input-box">
                    <input type="text" id="first_name" name="first_name" class="input-field" placeholder="First Name" autocomplete="off" required>
                    <p id="first-name-error" class="error-message">Enter a valid first name.</p>
                </div>
                <div class="input-box">
                    <input type="text" id="last_name" name="last_name" class="input-field" placeholder="Last Name" autocomplete="off" required>
                    <p id="last-name-error" class="error-message">Enter a valid last name.</p>
                </div>
            </div>

            <div class="input-box">
                <input type="email" id="email" name="email" class="input-field" placeholder="Email" autocomplete="off" required>
                <p id="email-error" class="error-message">Email must be at least 12 characters long.</p>
            </div>

            <!-- Student Fields -->
            <div id="student-fields">
                <div class="input-box">
                    <input type="text" id="student_id" name="student_id" class="input-field" placeholder="Student ID" autocomplete="off">
                    <p id="reg-error" class="error-message">Student ID must be numbers only.</p>
                </div>
            </div>

            <!-- Therapist Fields -->
            <div id="therapist-fields" class="hidden">
                <div class="input-box">
                    <input type="text" id="license_number" name="license_number" class="input-field" placeholder="License Number (e.g., LIC12345)" autocomplete="off">
                    <p id="license-error" class="error-message">License number is required for therapists.</p>
                </div>

                <div class="input-row">
                    <div class="input-box">
                        <input type="text" id="phone" name="phone" class="input-field" placeholder="Phone (+254...)" autocomplete="off">
                    </div>
                    <div class="input-box">
                        <select name="gender" id="gender" class="input-field">
                            <option value="" disabled selected>Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="non-binary">Non-binary</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                    </div>
                </div>

                <div class="input-box">
                    <textarea id="bio" name="bio" class="input-field" placeholder="Professional bio and approach to therapy..." rows="3"></textarea>
                </div>

                <div class="input-box">
                    <label style="display: block; margin-bottom: 10px; font-weight: 500;">Specializations:</label>
                    <div class="checkbox-group" id="specializations">
                        <div class="checkbox-item">
                            <input type="checkbox" id="anxiety" name="specializations" value="anxiety">
                            <label for="anxiety">Anxiety</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="depression" name="specializations" value="depression">
                            <label for="depression">Depression</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="academic_stress" name="specializations" value="academic_stress">
                            <label for="academic_stress">Academic Stress</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="trauma_therapy" name="specializations" value="trauma_therapy">
                            <label for="trauma_therapy">Trauma Therapy</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="relationship_counseling" name="specializations" value="relationship_counseling">
                            <label for="relationship_counseling">Relationship Counseling</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="eating_disorders" name="specializations" value="eating_disorders">
                            <label for="eating_disorders">Eating Disorders</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="substance_abuse" name="specializations" value="substance_abuse">
                            <label for="substance_abuse">Substance Abuse</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="cognitive_behavioral" name="specializations" value="cognitive_behavioral">
                            <label for="cognitive_behavioral">CBT</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="crisis_intervention" name="specializations" value="crisis_intervention">
                            <label for="crisis_intervention">Crisis Intervention</label>
                        </div>
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-box">
                        <input type="number" id="max_students" name="max_students" class="input-field" placeholder="Max Students" min="5" max="50" value="20">
                    </div>
                    <div class="input-box">
                        <label style="display: flex; align-items: center; gap: 8px; padding: 0 20px; height: 50px; background: #374151; border-radius: 25px; border: 1px solid #4b5563;">
                            <input type="checkbox" id="emergency_hours" name="emergency_hours" value="true" style="accent-color: #60a5fa;">
                            <span>Emergency Hours Available</span>
                        </label>
                    </div>
                </div>

                <div class="input-box">
                    <label style="display: block; margin-bottom: 10px; font-weight: 500;">Weekly Availability:</label>
                    <div class="availability-grid">
                        <div class="day-schedule">
                            <div class="day-checkbox">
                                <input type="checkbox" id="monday" name="available_days" value="monday">
                                <label for="monday">Monday</label>
                            </div>
                            <div class="time-inputs">
                                <input type="time" name="monday_start" class="input-field" disabled>
                                <input type="time" name="monday_end" class="input-field" disabled>
                            </div>
                        </div>
                        <div class="day-schedule">
                            <div class="day-checkbox">
                                <input type="checkbox" id="tuesday" name="available_days" value="tuesday">
                                <label for="tuesday">Tuesday</label>
                            </div>
                            <div class="time-inputs">
                                <input type="time" name="tuesday_start" class="input-field" disabled>
                                <input type="time" name="tuesday_end" class="input-field" disabled>
                            </div>
                        </div>
                        <div class="day-schedule">
                            <div class="day-checkbox">
                                <input type="checkbox" id="wednesday" name="available_days" value="wednesday">
                                <label for="wednesday">Wednesday</label>
                            </div>
                            <div class="time-inputs">
                                <input type="time" name="wednesday_start" class="input-field" disabled>
                                <input type="time" name="wednesday_end" class="input-field" disabled>
                            </div>
                        </div>
                        <div class="day-schedule">
                            <div class="day-checkbox">
                                <input type="checkbox" id="thursday" name="available_days" value="thursday">
                                <label for="thursday">Thursday</label>
                            </div>
                            <div class="time-inputs">
                                <input type="time" name="thursday_start" class="input-field" disabled>
                                <input type="time" name="thursday_end" class="input-field" disabled>
                            </div>
                        </div>
                        <div class="day-schedule">
                            <div class="day-checkbox">
                                <input type="checkbox" id="friday" name="available_days" value="friday">
                                <label for="friday">Friday</label>
                            </div>
                            <div class="time-inputs">
                                <input type="time" name="friday_start" class="input-field" disabled>
                                <input type="time" name="friday_end" class="input-field" disabled>
                            </div>
                        </div>
                        <div class="day-schedule">
                            <div class="day-checkbox">
                                <input type="checkbox" id="saturday" name="available_days" value="saturday">
                                <label for="saturday">Saturday</label>
                            </div>
                            <div class="time-inputs">
                                <input type="time" name="saturday_start" class="input-field" disabled>
                                <input type="time" name="saturday_end" class="input-field" disabled>
                            </div>
                        </div>
                        <div class="day-schedule">
                            <div class="day-checkbox">
                                <input type="checkbox" id="sunday" name="available_days" value="sunday">
                                <label for="sunday">Sunday</label>
                            </div>
                            <div class="time-inputs">
                                <input type="time" name="sunday_start" class="input-field" disabled>
                                <input type="time" name="sunday_end" class="input-field" disabled>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-box">
                <input type="password" id="password" name="password" class="input-field" placeholder="Password" autocomplete="off" required>
                <p id="password-error" class="error-message">Password must be at least 8 characters long and contain letters and numbers.</p>
            </div>
            <div class="input-box">
                <input type="password" id="confirm_password" name="confirm_password" class="input-field" placeholder="Confirm Password" autocomplete="off" required>
                <p id="confirm-error" class="error-message">Passwords do not match!</p>
            </div>
            <div class="input-submit">
                <button type="submit" class="submit-btn">Sign Up</button>
            </div>
        </form>

        <script>
            // Mock data for development
            const mockStudents = [
                {
                    first_name: "John",
                    last_name: "Kariuki",
                    email: "john.kariuki@student.university.ac.ke",
                    student_id: "2021001234"
                },
                {
                    first_name: "Mary",
                    last_name: "Wanjiku",
                    email: "mary.wanjiku@student.university.ac.ke", 
                    student_id: "2021005678"
                }
            ];

            const mockTherapists = [
                {
                    first_name: "Grace",
                    last_name: "Wanjiku",
                    email: "grace.wanjiku@university.edu",
                    license_number: "LIC12345",
                    phone: "+254712345678",
                    gender: "female",
                    bio: "Specializing in anxiety and depression with 8+ years of experience. I use evidence-based CBT techniques to help students develop practical coping skills.",
                    specializations: ["anxiety", "depression", "cognitive_behavioral"],
                    max_students: 25,
                    emergency_hours: true,
                    availability: {
                        monday: {start: "09:00", end: "17:00"},
                        wednesday: {start: "10:00", end: "18:00"},
                        friday: {start: "08:00", end: "16:00"}
                    }
                },
                {
                    first_name: "Michael",
                    last_name: "Chen",
                    email: "michael.chen@university.edu",
                    license_number: "LIC67890",
                    phone: "+254723456789",
                    gender: "male",
                    bio: "Academic stress specialist helping students navigate university pressures using mindfulness-based approaches.",
                    specializations: ["academic_stress", "anxiety", "cognitive_behavioral"],
                    max_students: 20,
                    emergency_hours: false,
                    availability: {
                        tuesday: {start: "11:00", end: "19:00"},
                        thursday: {start: "09:00", end: "17:00"},
                        saturday: {start: "10:00", end: "14:00"}
                    }
                },
                {
                    first_name: "Amanda",
                    last_name: "Torres",
                    email: "amanda.torres@university.edu",
                    license_number: "LIC55555",
                    phone: "+254701234567",
                    gender: "female",
                    bio: "Crisis intervention specialist available for urgent mental health situations. Trained in suicide prevention and emergency support.",
                    specializations: ["crisis_intervention", "anxiety", "depression"],
                    max_students: 30,
                    emergency_hours: true,
                    availability: {
                        monday: {start: "08:00", end: "20:00"},
                        tuesday: {start: "08:00", end: "20:00"},
                        wednesday: {start: "08:00", end: "20:00"},
                        thursday: {start: "08:00", end: "20:00"},
                        friday: {start: "08:00", end: "20:00"}
                    }
                }
            ];

            function toggleFields() {
                const role = document.getElementById('role').value;
                const studentFields = document.getElementById('student-fields');
                const therapistFields = document.getElementById('therapist-fields');
                
                if (role === 'student') {
                    studentFields.classList.remove('hidden');
                    therapistFields.classList.add('hidden');
                    document.getElementById('student_id').required = true;
                    document.getElementById('license_number').required = false;
                } else if (role === 'therapist') {
                    studentFields.classList.add('hidden');
                    therapistFields.classList.remove('hidden');
                    document.getElementById('student_id').required = false;
                    document.getElementById('license_number').required = true;
                }
            }

            function fillMockData() {
                const role = document.getElementById('role').value;
                if (!role) {
                    alert('Please select a role first');
                    return;
                }

                let mockData;
                if (role === 'student') {
                    mockData = mockStudents[Math.floor(Math.random() * mockStudents.length)];
                } else if (role === 'therapist') {
                    mockData = mockTherapists[Math.floor(Math.random() * mockTherapists.length)];
                }

                // Fill common fields
                document.getElementById('first_name').value = mockData.first_name;
                document.getElementById('last_name').value = mockData.last_name;
                document.getElementById('email').value = mockData.email;
                document.getElementById('password').value = 'Password123';
                document.getElementById('confirm_password').value = 'Password123';

                // Fill role-specific fields
                if (role === 'student') {
                    document.getElementById('student_id').value = mockData.student_id;
                } else if (role === 'therapist') {
                    document.getElementById('license_number').value = mockData.license_number;
                    document.getElementById('phone').value = mockData.phone;
                    document.getElementById('gender').value = mockData.gender;
                    document.getElementById('bio').value = mockData.bio;
                    document.getElementById('max_students').value = mockData.max_students;
                    document.getElementById('emergency_hours').checked = mockData.emergency_hours;

                    // Fill specializations
                    document.querySelectorAll('input[name="specializations"]').forEach(checkbox => {
                        checkbox.checked = mockData.specializations.includes(checkbox.value);
                    });

                    // Fill availability
                    Object.keys(mockData.availability).forEach(day => {
                        const dayCheckbox = document.getElementById(day);
                        const startTime = document.querySelector(`input[name="${day}_start"]`);
                        const endTime = document.querySelector(`input[name="${day}_end"]`);
                        
                        if (dayCheckbox && startTime && endTime) {
                            dayCheckbox.checked = true;
                            startTime.disabled = false;
                            endTime.disabled = false;
                            startTime.value = mockData.availability[day].start;
                            endTime.value = mockData.availability[day].end;
                        }
                    });
                }
            }

            // Enable/disable time inputs based on day selection
            document.querySelectorAll('input[name="available_days"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const day = this.value;
                    const startTime = document.querySelector(`input[name="${day}_start"]`);
                    const endTime = document.querySelector(`input[name="${day}_end"]`);
                    
                    if (startTime && endTime) {
                        startTime.disabled = !this.checked;
                        endTime.disabled = !this.checked;
                        
                        if (!this.checked) {
                            startTime.value = '';
                            endTime.value = '';
                        }
                    }
                });
            });

            function validateForm() {
                const role = document.getElementById("role").value;
                var firstName = document.getElementById("first_name").value.trim();
                var lastName = document.getElementById("last_name").value.trim();
                var email = document.getElementById("email").value;
                var password = document.getElementById("password").value;
                var confirmPassword = document.getElementById("confirm_password").value;

                var firstNameError = document.getElementById("first-name-error");
                var lastNameError = document.getElementById("last-name-error");
                var emailError = document.getElementById("email-error");
                var passwordError = document.getElementById("password-error");
                var confirmError = document.getElementById("confirm-error");

                var isValid = true;

                // First name validation
                if (!/^[A-Za-z]+$/.test(firstName)) {
                    firstNameError.style.display = "block";
                    isValid = false;
                } else {
                    firstNameError.style.display = "none";
                }
                
                // Last name validation
                if (!/^[A-Za-z]+$/.test(lastName)) {
                    lastNameError.style.display = "block";
                    isValid = false;
                } else {
                    lastNameError.style.display = "none";
                }

                // Email validation (min 12 characters)
                if (email.length < 12) {
                    emailError.style.display = "block";
                    isValid = false;
                } else {
                    emailError.style.display = "none";
                }

                // Role-specific validation
                if (role === 'student') {
                    var student_id = document.getElementById("student_id").value;
                    var regError = document.getElementById("reg-error");
                    
                    if (!/^\d+$/.test(student_id)) {
                        regError.style.display = "block";
                        isValid = false;
                    } else {
                        regError.style.display = "none";
                    }
                } else if (role === 'therapist') {
                    var license_number = document.getElementById("license_number").value;
                    var licenseError = document.getElementById("license-error");
                    
                    if (!license_number.trim()) {
                        licenseError.style.display = "block";
                        isValid = false;
                    } else {
                        licenseError.style.display = "none";
                    }

                    // Check at least one specialization is selected
                    const selectedSpecs = document.querySelectorAll('input[name="specializations"]:checked');
                    if (selectedSpecs.length === 0) {
                        alert('Please select at least one specialization');
                        isValid = false;
                    }
                }

                // Password validation (min 8 characters with letters & numbers)
                var passwordPattern = /^(?=.*[A-Za-z])(?=.*\d).{8,}$/;
                if (!passwordPattern.test(password)) {
                    passwordError.style.display = "block";
                    isValid = false;
                } else {
                    passwordError.style.display = "none";
                }

                // Confirm password validation
                if (password !== confirmPassword) {
                    confirmError.style.display = "block";
                    isValid = false;
                } else {
                    confirmError.style.display = "none";
                }

                return isValid;
            }
        </script>

        <div class="sign-up-link">
            <p>Already have an account? <a href="{{ url_for('auth.login') }}">Login</a></p>
        </div>
    </div>
</body>
</html>